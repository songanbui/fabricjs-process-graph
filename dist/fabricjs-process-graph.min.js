/*! fabricjs-process-graph 28-10-2021 */

!function i(a,o,r){function s(e,t){if(!o[e]){if(!a[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(c)return c(e,!0);throw(n=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",n}n=o[e]={exports:{}},a[e][0].call(n.exports,function(t){return s(a[e][1][t]||t)},n,n.exports,i,a,o,r)}return o[e].exports}for(var c="function"==typeof require&&require,t=0;t<r.length;t++)s(r[t]);return s}({1:[function(t,e,n){"use strict";var i=c(t("./src/ProcessGraph.js")),a=c(t("./src/LinkableShape.js")),o=c(t("./src/Container.js")),r=c(t("./src/ExpandableContainer.js")),s=c(t("./src/Link.js")),t=c(t("./src/CurvedLink.js"));function c(t){return t&&t.__esModule?t:{default:t}}window.pg={ProcessGraph:i.default,LinkableShape:a.default,Container:o.default,ExpandableContainer:r.default,Link:s.default,CurvedLink:t.default}},{"./src/Container.js":2,"./src/CurvedLink.js":3,"./src/ExpandableContainer.js":4,"./src/Link.js":5,"./src/LinkableShape.js":6,"./src/ProcessGraph.js":7}],2:[function(t,e,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(t("./LinkableShape.js")),p=o(t("./CurvedLink.js"));function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=h(n);return function(t,e){{if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined")}return function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t)}(this,i?(t=h(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var t=window,l=t.fabric,u=t._,t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(d,i["default"]);var t,e,n,o=c(d);function d(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var n=new l.Rect({left:0,top:0,originX:"left",originY:"top",strokeWidth:1,stroke:"#000",fill:"#fff",rx:10,ry:10,width:t.width||200,height:t.height||100}),i=new l.Textbox(t.label,{left:n.width/2,top:n.height/2,styles:{},fontSize:14,fontFamily:"Helvetica",textAlign:"center",originX:"center",originY:"center",width:190,height:90,splitByGrapheme:!0}),a=new l.Group([n,i],{left:0,top:0,originX:"left",originY:"top"}),n=u.cloneDeep(u.omit(t,["canvas","shape"]));return n.canvas=t.canvas,n.shape=a,e=o.call(this,n),a.on({scaling:function(){a.scaleX<1?i.scaleX=1-a.scaleX+1:i.scaleX=1/a.scaleX,a.scaleY<1?i.scaleY=1-a.scaleY+1:i.scaleY=1/a.scaleY,e.canvas.renderAll()}}),e}return t=d,(e=[{key:"_onAnchorRightClick",value:function(t){var e=this.shape,n=e.id,i=e.left,a=e.top,o=e.angle,r=e.canvas,s=e.width,c=e.height,e=t.target,t=e.cardinal,n=new d({canvas:r,id:"".concat(n,"_next_").concat(t,"_").concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),left:i,top:a,angle:o,label:"".concat(n,"_next_").concat(t)});n.inject();var h,l={};switch(t){case"east":h="west",l.y=a,l.x=i+s+50;break;case"west":h="east",l.y=a,l.x=i-s-50;break;case"north":h="south",l.y=a-c-50,l.x=i;break;case"south":h="north",l.y=a+c+50,l.x=i;break;case"northeast":h="southwest",l.y=a-c-50,l.x=i+s+50;break;case"northwest":h="southeast",l.y=a-c-50,l.x=i-s-50;break;case"southeast":h="northwest",l.x=a+c+50,l.y=i+s+50;break;default:h="northeast",l.y=a+c+50,l.x=i-s-50}n.move(l);t=new p.default({canvas:r,start:{x:e.left,y:e.top},end:{x:n.anchors[h].left,y:n.anchors[h].top}});t.inject(r),t.connectLink("start",e.shapeId,e.cardinal),t.connectLink("end",n.anchors[h].shapeId,n.anchors[h].cardinal)}},{key:"_onAnchorLeftClick",value:function(t){var e=this,t=t.target,n=this.canvas;this.canvas.selection=!1;var i=new p.default({canvas:n,start:{x:t.left,y:t.top,direction:t.cardinal},end:{x:t.left,y:t.top,direction:{east:"west",west:"east",north:"south",south:"north"}[t.cardinal]}});i.inject(n),i.connectLink("start",t.shapeId,t.cardinal),i.arrowHead.fire("mousedown");var a=function(t){i.arrowHead.left=t.pointer.x,i.arrowHead.top=t.pointer.y,i.arrowHead.fire("moving")};n.on("mouse:move",a);t=function t(){e.canvas.selection=!0,i.arrowHead.fire("moved"),i.arrowHead.fire("mouseup"),n.off("mouse:move",a),n.off("mouse:up",t)};n.on("mouse:up",t)}}])&&r(t.prototype,e),n&&r(t,n),d}();n.default=t},{"./CurvedLink.js":3,"./LinkableShape.js":6}],3:[function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=window.fabric,a=function(){function s(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var n=t.id,i=t.canvas;this.id=n,this.canvas=i,this.direction={start:t&&t.start&&t.start.direction?t.start.direction:"east",end:t&&t.end&&t.end.direction?t.end.direction:"west"};var a={x:t&&t.start&&t.start.x?t.start.x:0,y:t&&t.start&&t.start.y?t.start.y:0},n={x:t&&t.end&&t.end.x?t.end.x:0,y:t&&t.end&&t.end.y?t.end.y:0},i=this.computePathCoords({start:{x:a.x,y:a.y,direction:this.direction.start},end:{x:n.x,y:n.y,direction:this.direction.end}}).pathCoordsArray,t=this.defaultPathOptions={fill:"",stroke:t.custom&&t.custom.path&&t.custom.path.stroke?t.custom.path.stroke:"#999",strokeWidth:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.strokeWidth:2,objectCaching:!1,selectable:!0,hasBorders:!0,hasControls:!1,perPixelTargetFind:!0},t=new c.Path(i,t);this.path=t;var t={objectCaching:!1,left:0,top:0,strokeWidth:1,radius:16,fill:"#57b857",stroke:"#57b857",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:0},o=this.arrowHead=new c.Triangle({objectCaching:!1,width:10,height:10,left:n.x,top:n.y,strokeWidth:1,fill:"#ddd",opacity:1,stroke:"#999",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1});this.isValidHeadConnectionMask=new c.Circle(t),o.on("moving",function(){e.updatePath({end:{x:o.left,y:o.top},commit:!1}),e._checkExtremityCanBeConnected("end")}),o.on("moved",function(){e.updatePath({end:{x:o.left,y:o.top},commit:!0}),e.isValidHeadConnectionMask.set("opacity",0),e._connectDisconnectExtremity("end")}),o.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),o.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})});var r=this.arrowTail=new c.Rect({objectCaching:!1,width:10,height:10,left:a.x,top:a.y,strokeWidth:1,fill:"#ddd",opacity:1,stroke:"#999",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1});this.isValidTailConnectionMask=new c.Circle(t),r.on("moving",function(){e.updatePath({start:{x:r.left,y:r.top},commit:!1}),e._checkExtremityCanBeConnected("start")}),r.on("moved",function(){e.updatePath({start:{x:r.left,y:r.top},commit:!0}),e.isValidTailConnectionMask.set("opacity",0),e._connectDisconnectExtremity("start")}),r.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),r.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})})}var t,e,n;return t=s,(e=[{key:"inject",value:function(){var t=this.id,e=this.canvas,n=this.path,i=this.arrowHead,a=this.arrowTail,o=this.isValidTailConnectionMask,r=this.isValidHeadConnectionMask;return e.add(o),e.add(r),e.add(i),e.add(a),e.add(n),this.updatePath({start:{x:n.path[0][1],y:n.path[0][2]},end:{x:n.path[2][5],y:n.path[2][6]},commit:!0}),e.links[t]=this}},{key:"remove",value:function(){var t=this.id,e=this.canvas,n=this.path,i=this.arrowHead,a=this.arrowTail,o=this.isValidTailConnectionMask,r=this.isValidHeadConnectionMask;e.remove(o),e.remove(r),e.remove(i),e.remove(a),e.remove(n),delete e.links[t]}},{key:"connectLink",value:function(e,n,i){var a,t,o=this;this.isValidConnection(e,n,i)&&(a=this.canvas.getObjects().find(function(t){return t.id===n}),this.disconnectLink(e),this.direction[e]=i,this[e]={shape:a,anchor:i,handlers:{onAnchorPositionModifying:function(){var t={commit:!1};t[e]={x:a.anchors[i].left,y:a.anchors[i].top},o.updatePath(t)},onAnchorPositionModified:function(){var t={commit:!0};t[e]={x:a.anchors[i].left,y:a.anchors[i].top},o.updatePath(t)}}},a.anchors[i].on("pg:position:modifying",this[e].handlers.onAnchorPositionModifying),a.anchors[i].on("pg:position:modified",this[e].handlers.onAnchorPositionModified),(t={commit:!1})[e]={x:a.anchors[i].left,y:a.anchors[i].top},this.updatePath(t))}},{key:"disconnectLink",value:function(t){this[t]&&(this[t].shape.anchors[this[t].anchor].off("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),this[t].shape.anchors[this[t].anchor].off("pg:position:modified",this[t].handlers.onAnchorPositionModified),delete this[t])}},{key:"bringToFront",value:function(){var t=this.canvas,e=this.path,n=this.arrowHead,i=this.arrowTail;t.bringToFront(e),t.bringToFront(n),t.bringToFront(i)}},{key:"computePathCoords",value:function(t){var e,n,i={x:t.start.x,y:t.start.y,direction:t.start&&t.start.direction?t.start.direction:this.direction.start},a={x:t.end.x,y:t.end.y,direction:t.end&&t.end.direction?t.end.direction:this.direction.end},o={x:(i.x+a.x)/2,y:(i.y+a.y)/2},r={start:{x:i.x,y:i.y},end:{x:a.x,y:a.y},center1:{x:o.x,y:o.y},center2:{x:o.x,y:o.y}};switch(t.start.direction){case"north":r.start.y-=Math.abs(i.y-o.y);break;case"south":r.start.y+=Math.abs(i.y-o.y);break;case"east":r.start.x+=Math.abs(i.x-o.x);break;default:r.start.x-=Math.abs(i.x-o.x)}switch(t.end.direction){case"north":r.end.y-=Math.abs(a.y-o.y);break;case"south":r.end.y+=Math.abs(a.y-o.y);break;case"east":r.end.x+=Math.abs(a.x-o.x);break;default:r.end.x-=Math.abs(a.x-o.x)}i.direction===a.direction?"south"===i.direction||"north"===i.direction?(this.start&&this.end&&Math.abs(i.y-a.y)<10&&(o.x-=(this.start.shape.width+this.end.shape.width)/2),o.y+="south"===i.direction?40:-40,r.start.y=i.y+("south"===i.direction?40:-40),r.end.y=a.y+("south"===i.direction?40:-40),r.center1.x=o.x,r.center2.x=o.x,r.center1.y=r.start.y,r.center2.y=r.end.y):"east"!==i.direction&&"west"!==i.direction||(this.start&&this.end&&Math.abs(i.y-a.y)<10&&(o.y-=(this.start.shape.height+this.end.shape.height)/2),o.x+="east"===i.direction?40:-40,r.start.x=i.x+("east"===i.direction?40:-40),r.end.x=a.x+("east"===i.direction?40:-40),r.center1.x=r.start.x,r.center2.x=r.end.x,r.center1.y=o.y,r.center2.y=o.y):"south"===i.direction||"north"===i.direction?(r.center1.x=o.x,r.center1.y=r.start.y,r.center2.x=o.x,r.center2.y=r.end.y):"east"!==i.direction&&"west"!==i.direction||(r.center1.x=r.start.x,r.center1.y=o.y,r.center2.x=r.end.x,r.center2.y=o.y),this.start&&this.start.shape&&this.start.shape.angle&&(e=this.start.shape.angle*Math.PI/180,t=new c.Point(r.start.x,r.start.y),n=new c.Point(i.x,i.y),n=c.util.rotatePoint(t,n,e),r.start.x=n.x,r.start.y=n.y),this.end&&this.end.shape&&this.end.shape.angle&&(s=this.end.shape.angle*Math.PI/180,e=new c.Point(r.end.x,r.end.y),n=new c.Point(a.x,a.y),s=c.util.rotatePoint(e,n,s),r.end.x=s.x,r.end.y=s.y);var s={start:{x:i.x,y:i.y},end:{x:a.x,y:a.y},center:o,controls:{start:{x:r.start.x,y:r.start.y},end:{x:r.end.x,y:r.end.y},center1:{x:r.center1.x,y:r.center1.y},center2:{x:r.center2.x,y:r.center2.y}}};return{pathCoords:s,pathCoordsArray:[["M",s.start.x,s.start.y],["C",s.controls.start.x,s.controls.start.y,s.controls.center1.x,s.controls.center1.y,s.center.x,s.center.y],["C",s.controls.center2.x,s.controls.center2.y,s.controls.end.x,s.controls.end.y,s.end.x,s.end.y]]}}},{key:"updatePath",value:function(t){var n,e={x:t.start&&t.start.x?t.start.x:this.path.path[0][1],y:t.start&&t.start.y?t.start.y:this.path.path[0][2],direction:t.start&&t.start.direction?t.start.direction:this.direction.start},i={x:t.end&&t.end.x?t.end.x:this.path.path[2][5],y:t.end&&t.end.y?t.end.y:this.path.path[2][6],direction:t.end&&t.end.direction?t.end.direction:this.direction.end},a=this.computePathCoords({start:e,end:i}).pathCoordsArray;t.commit?(e=new c.Path(a,this.defaultPathOptions),this.canvas.remove(this.path),this.canvas.add(e),e.on("mousedown",this.bringToFront.bind(this)),e.on("moving",this.onLinkMoving.bind(this)),e.on("moved",this.onLinkMoved.bind(this)),i=[this.arrowHead,this.arrowTail],t=e.calcTransformMatrix(),n=c.util.invertTransform(t),i.forEach(function(t){var e=c.util.multiplyTransformMatrices(n,t.calcTransformMatrix());t.relationship=e}),this.path=e):this.path.set("path",a);a=180*Math.atan2(this.path.path[2][6]-this.path.path[2][4],this.path.path[2][5]-this.path.path[2][3])/Math.PI;this.arrowHead.angle=90+a,this.arrowHead.left=this.path.path[2][5],this.arrowHead.top=this.path.path[2][6],this.arrowHead.setCoords(),this.arrowTail.left=this.path.path[0][1],this.arrowTail.top=this.path.path[0][2],this.arrowTail.setCoords(),this.bringToFront()}},{key:"isValidConnection",value:function(t,e,n){var i=this.canvas.getObjects().find(function(t){return t.id===e});if("start"===t){if(this.start&&this.start.shape&&this.start.shape.id===i.id&&this.start.cardinal===n)return!1;if(this.end&&this.end.shape&&this.end.shape.id===i.id)return!1}else if("end"===t){if(this.end&&this.end.shape&&this.end.shape.id===i.id&&this.end.cardinal===n)return!1;if(this.start&&this.start.shape&&this.start.shape.id===i.id)return!1}return!0}},{key:"toggleAllAnchorsOpacity",value:function(t){}},{key:"onLinkMoving",value:function(){var n=this,t=[this.arrowHead,this.arrowTail],i=this.arrowHead.angle,a=this.arrowTail.angle;t.forEach(function(t){var e;t.relationship&&(e=t.relationship,e=c.util.multiplyTransformMatrices(n.path.calcTransformMatrix(),e),e=c.util.qrDecompose(e),t.set({flipX:!1,flipY:!1}),t.setPositionByOrigin({x:e.translateX,y:e.translateY},"center","center"),t.set(e),t.angle=t===n.arrowHead?i:a,t.setCoords())}),this._checkExtremityCanBeConnected("start"),this._checkExtremityCanBeConnected("end")}},{key:"onLinkMoved",value:function(){this.updatePath({start:{x:this.arrowTail.left,y:this.arrowTail.top},end:{x:this.arrowHead.left,y:this.arrowHead.top},commit:!0}),this.isValidTailConnectionMask.set("opacity",0),this.isValidHeadConnectionMask.set("opacity",0),this._connectDisconnectExtremity("start"),this._connectDisconnectExtremity("end")}},{key:"_checkExtremityCanBeConnected",value:function(t){var e,n,i=this.canvas;"start"===t?(e=this.arrowTail,n=this.isValidTailConnectionMask):"end"===t&&(e=this.arrowHead,n=this.isValidHeadConnectionMask),n.left=e.left,n.top=e.top,n.setCoords(),n.set("opacity",0);for(var a,o=i.getObjects().filter(function(t){return"anchor"===t.type}),r=0;r<o.length;r+=1)e.intersectsWithObject(o[r])&&(n.set("opacity",.5),this.isValidConnection(t,o[r].shapeId,o[r].cardinal)?(n.set({stroke:"#57b857",fill:"#57b857"}),(a={commit:!1})[t]={x:e.left,y:e.top,direction:o[r].cardinal},this.updatePath(a)):n.set({stroke:"#ea4f37",fill:"#ea4f37"}))}},{key:"_connectDisconnectExtremity",value:function(t){var e,n=this.canvas;"start"===t?e=this.arrowTail:"end"===t&&(e=this.arrowHead);for(var i=n.getObjects().filter(function(t){return"anchor"===t.type}),a=0;a<i.length;a+=1)e.intersectsWithObject(i[a])?this.connectLink(t,i[a].shapeId,i[a].cardinal):this[t]&&i[a]===this[t].shape.anchors[this[t].anchor]&&this.disconnectLink(t)}}])&&i(t.prototype,e),n&&i(t,n),s}();n.default=a},{}],4:[function(t,e,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=i(t("./LinkableShape.js")),v=i(t("./CurvedLink.js"));function i(t){return t&&t.__esModule?t:{default:t}}function h(t,e,n,i,a,o,r){try{var s=t[o](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,a)}function l(s){return function(){var t=this,r=arguments;return new Promise(function(e,n){var i=s.apply(t,r);function a(t){h(i,e,n,a,o,"next",t)}function o(t){h(i,e,n,a,o,"throw",t)}a(void 0)})}}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);return function(t,e){{if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined")}return function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t)}(this,i?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var t=window,f=t.fabric,b=t._,t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(g,c["default"]);var t,e,n,i,a,o,r,s=u(g);function g(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g);var e=new f.Group([],{left:t.left,top:t.top,originX:"left",originY:"top"}),n=b.cloneDeep(b.omit(t,["canvas","shape"]));return n.canvas=t.canvas,n.shape=e,(n=s.call(this,n)).shapes={},n.children=Array.isArray(t.children)?t.children:[],n.isExpanded=!1,n}return t=g,(e=[{key:"load",value:(r=l(regeneratorRuntime.mark(function t(e){var n,i,a,o,r,s,c,h,l,d,p=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.options,i=this.shape,this.isLoaded=!1,a={left:this.shape.left,top:this.shape.top},r=o=10,s={left:0,top:0,originX:"left",originY:"top",strokeWidth:1,stroke:"#666",fill:"#fff",rx:4,ry:4},e?(s.width=n.width||70,s.height=n.height||70,c={originX:"left",originY:"top",left:o,top:o,width:22,height:22}):(c={originX:"left",originY:"top",left:o,top:o,width:22,height:22},s.width=n.width||200,s.height=n.height||c.height+2*o),h=new f.Rect(s),this.shape.addWithUpdate(h),this.shapes.rect=h,this.options.img&&this.options.img.src)return t.next=13,this._loadImage(this.options.img.src);t.next=20;break;case 13:(l=t.sent).set(c),this.shape.addWithUpdate(l),this.shapes.image=l,l={styles:{},fontSize:14,fontFamily:"Helvetica",textAlign:"left",splitByGrapheme:!0,fill:"#000",originX:"left",originY:"center",left:o+l.width+r,top:o+l.height/2,width:h.width-o-l.width-2*r,height:l.height},t.next=21;break;case 20:l={styles:{},fontSize:14,fontFamily:"Helvetica",textAlign:"center",splitByGrapheme:!0,fill:"#000",originX:"center",originY:"center",left:h.width/2,top:h.height/2,width:s.width-2*o,height:s.height-2*o};case 21:if(d=new f.Textbox(n.label,l),n.hideText||this.shape.addWithUpdate(d),this.shapes.text=d,this.shape.left=a.left,this.shape.top=a.top,this.shape.setCoords(),this.canvas.renderAll(),e&&(this.shape.selectable=!1),this.initialOpts={rect:{width:s.width,height:s.height},child:{width:n.childWidth||70,height:n.childHeight||70}},e){t.next=33;break}return t.next=33,this.constructChildren();case 33:return i.on({scaling:function(){d&&(i.scaleX<1?d.scaleX=1-i.scaleX+1:d.scaleX=1/i.scaleX,i.scaleY<1?d.scaleY=1-i.scaleY+1:d.scaleY=1/i.scaleY,p.canvas.renderAll())},mousedblclick:function(){p.isExpanded?p.collapse():p.expand()}}),this.isLoaded=!0,t.abrupt("return",this);case 36:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"_loadImage",value:(o=l(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e||this.options.img.src,t.abrupt("return",new Promise(function(e){f.Image.fromURL(n,function(t){e(t)})}));case 2:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"constructChildren",value:(a=l(regeneratorRuntime.mark(function t(){var e,n,i,a,o,r,s,c,h,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.canvas,n=this.shape,i=this.shapes,a=this.children,o=this.initialOpts,s=r=10,c=0;case 4:if(c<a.length)return h=a[c],l=new g({canvas:e,id:h.id,left:n.left+r+(o.child.width+s)*c+(c===a.length?-s:0),top:n.top+r+i.image.height+s,angle:0,label:h.label,img:{src:h.img.src},width:o.child.width,height:o.child.height,hideText:h.hideText}),t.next=9,l.load(!0);t.next=13;break;case 9:h.container=l;case 10:c+=1,t.next=4;break;case 13:n.addWithUpdate(),n.setCoords(),e.renderAll();case 16:case"end":return t.stop()}},t,this)})),function(){return a.apply(this,arguments)})},{key:"setActive",value:function(t){t?(this.shapes.rect.set("stroke","#78befa"),this.shapes.text.set("fill","#78befa")):(this.shapes.rect.set("stroke","#666"),this.shapes.text.set("fill","#000"))}},{key:"expand",value:function(){if(0!==this.children.length&&!1===this.isExpanded){var t=this.canvas,e=this.shape,n=this.shapes,i=this.children,a=this.initialOpts,o=n.rect.width,r=n.rect.height,s=Math.max(20+i.length*a.child.width+10*(i.length-1),a.rect.width),c=0<i.length?10+n.image.height+10+a.child.height+10:a.rect.height;n.rect.opacity=.7;var h=Object.values(t.linkableShapes);if(1<h.length)for(var l=s-o,d=c-r,p=0;p<h.length;p+=1){var u=h[p];u.id!==this.id&&(this.shape.aCoords.br.x<=u.shape.aCoords.tl.x&&this.shape.aCoords.br.y<=u.shape.aCoords.tl.y?u.move({x:u.shape.left+l,y:u.shape.top+d,moving:!1,skipCollision:!0}):this.shape.aCoords.bl.y<u.shape.aCoords.tl.y?this.shape.aCoords.tl.x<u.shape.aCoords.tr.x&&u.move({y:u.shape.top+d,moving:!1,skipCollision:!0}):this.shape.aCoords.tr.x<u.shape.aCoords.tl.x&&this.shape.aCoords.tl.y<u.shape.aCoords.bl.y&&u.move({x:u.shape.left+l,moving:!1,skipCollision:!0}))}n.rect.width=s,n.rect.height=c,n.rect.setCoords(),n.text.width=s-(n.image.width+10+10),n.text.textAlign="left",n.text.setCoords();for(var f=0;f<i.length;f+=1){var y=i[f];y.container.shape.left=e.left+10+(a.child.width+10)*f+(f===i.length?-10:0),y.container.shape.top=e.top+10+n.image.height+10,e.addWithUpdate(y.container.shape)}e.addWithUpdate(),e.setCoords(),this.bringToFront(),this.shape.fire("modified"),t.renderAll()}this.isExpanded=!0}},{key:"collapse",value:function(){if(0!==this.children.length&&!0===this.isExpanded){var t=this.canvas,e=this.shape,n=this.shapes,i=this.children,a=this.initialOpts,o=n.rect.width,r=n.rect.height,s=a.rect.width,c=a.rect.height;n.rect.opacity=1;var h=Object.values(t.linkableShapes);if(1<h.length)for(var l=s-o,d=c-r,p=0;p<h.length;p+=1){var u=h[p];h[p].id!==this.id&&(this.shape.aCoords.br.x<=u.shape.aCoords.tl.x&&this.shape.aCoords.br.y<=u.shape.aCoords.tl.y?u.move({x:u.shape.left+l,y:u.shape.top+d,moving:!1,skipCollision:!0}):this.shape.aCoords.bl.y<u.shape.aCoords.tl.y?this.shape.aCoords.tl.x<u.shape.aCoords.tr.x&&u.move({y:u.shape.top+d,moving:!1,skipCollision:!0}):this.shape.aCoords.tr.x<u.shape.aCoords.tl.x&&this.shape.aCoords.tl.y<u.shape.aCoords.bl.y&&u.move({x:u.shape.left+l,moving:!1,skipCollision:!0}))}n.rect.width=s,n.rect.height=c,n.rect.setCoords(),n.text.width=s-(n.image.width+20+10),n.text.textAlign="left",n.text.setCoords();for(var f=0;f<i.length;f+=1){var y=i[f];y.container.left=e.left+10+(a.child.width+10)*f+(f===i.length?-10:0),y.container.top=e.top+10+n.image.height+10,e.remove(y.container.shape)}e.addWithUpdate(),e.setCoords(),this.shape.fire("modified"),t.renderAll()}this.isExpanded=!1}},{key:"_onAnchorRightClick",value:(i=l(regeneratorRuntime.mark(function t(e){var n,i,a,o,r,s,c,h,l,d,p,u,f,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return p=this.shape,y=p.id,n=p.left,i=p.top,a=p.angle,o=p.canvas,r=p.width,s=p.height,c=e.target,h=c.cardinal,l=100,d="".concat(y,"_next_").concat(h,"_").concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),p="".concat(y,"_next_").concat(h),(y=b.cloneDeep(b.omit(this.options,["canvas","shape"]))).canvas=o,y.id=d,y.left=n,y.top=i,y.angle=a,y.label=p,y.children=[],p=new g(y),t.next=17,p.load();case 17:p.inject(),u={},t.t0=h,t.next="east"===t.t0?22:"west"===t.t0?26:"north"===t.t0?30:"south"===t.t0?34:"northeast"===t.t0?38:"northwest"===t.t0?42:"southeast"===t.t0?46:(t.t0,50);break;case 22:return f="west",u.y=i,u.x=n+r+l,t.abrupt("break",54);case 26:return f="east",u.y=i,u.x=n-r-l,t.abrupt("break",54);case 30:return f="south",u.y=i-s-l,u.x=n,t.abrupt("break",54);case 34:return f="north",u.y=i+s+l,u.x=n,t.abrupt("break",54);case 38:return f="southwest",u.y=i-s-l,u.x=n+r+l,t.abrupt("break",54);case 42:return f="southeast",u.y=i-s-l,u.x=n-r-l,t.abrupt("break",54);case 46:return f="northwest",u.y=i+s+l,u.x=n+r+l,t.abrupt("break",54);case 50:return f="northeast",u.y=i+s+l,u.x=n-r-l,t.abrupt("break",54);case 54:p.move(u),(y=new v.default({canvas:o,start:{x:c.left,y:c.top},end:{x:p.anchors[f].left,y:p.anchors[f].top}})).inject(o),y.connectLink("start",c.shapeId,c.cardinal),y.connectLink("end",p.anchors[f].shapeId,p.anchors[f].cardinal);case 59:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"_onAnchorLeftClick",value:function(t){var e=this,t=t.target,n=this.canvas;this.canvas.selection=!1;var i=new v.default({canvas:n,start:{x:t.left,y:t.top,direction:t.cardinal},end:{x:t.left,y:t.top,direction:{east:"west",west:"east",north:"south",south:"north"}[t.cardinal]}});i.inject(n),i.connectLink("start",t.shapeId,t.cardinal),i.arrowHead.fire("mousedown");var a=function(t){i.arrowHead.left=t.pointer.x,i.arrowHead.top=t.pointer.y,i.arrowHead.fire("moving")};n.on("mouse:move",a);t=function t(){e.canvas.selection=!0,i.arrowHead.fire("moved"),i.arrowHead.fire("mouseup"),n.off("mouse:move",a),n.off("mouse:up",t)};n.on("mouse:up",t)}}])&&d(t.prototype,e),n&&d(t,n),g}();n.default=t},{"./CurvedLink.js":3,"./LinkableShape.js":6}],5:[function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var d=window.fabric,a=function(){function l(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l);var n=t.id,i=t.canvas,a=t&&t.start&&t.start.x?t.start.x:0,o=t&&t.start&&t.start.y?t.start.y:0,r=t&&t.end&&t.end.x?t.end.x:0,s=t&&t.end&&t.end.y?t.end.y:0;this.id=n,this.canvas=i;n={M:{x:a,y:o},Q:{x1:(a+r)/2,y1:(o+s)/2,x2:r,y2:s}},i=this.defaultPathOptions={fill:"",stroke:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.stroke:"#000",strokeWidth:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.strokeWidth:2,objectCaching:!1,selectable:!0,hasBorders:!0,hasControls:!1,perPixelTargetFind:!0},t="M ".concat(n.M.x," ").concat(n.M.y," Q ").concat(n.Q.x1,", ").concat(n.Q.y1,", ").concat(n.Q.x2,", ").concat(n.Q.y2),t=new d.Path(t,i);this.path=t;i=this.controlPoint=new d.Circle({objectCaching:!1,left:n.Q.x1,top:n.Q.y1,strokeWidth:1,radius:6,fill:"#78befa",stroke:"#78befa",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!0,opacity:0});i.on("mouseover",this.onLinkMouseOver.bind(this)),i.on("mouseout",this.onLinkMouseOut.bind(this)),i.on("moving",function(){e.updatePath("control",e.controlPoint.left,e.controlPoint.top,!1)}),i.on("moved",function(){e.updatePath("control",e.controlPoint.left,e.controlPoint.top,!0)}),i.on("mousedown",function(){e.bringToFront()});t={objectCaching:!1,strokeDashArray:[5,5],strokeWidth:1,stroke:"#78befa",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,opacity:0},o=this.controlLine1=new d.Line([i.left,i.top,a,o],t);o.on("mouseover",this.onLinkMouseOver.bind(this)),o.on("mouseout",this.onLinkMouseOut.bind(this));s=this.controlLine2=new d.Line([i.left,i.top,r,s],t);s.on("mouseover",this.onLinkMouseOver.bind(this)),s.on("mouseout",this.onLinkMouseOut.bind(this));var t={objectCaching:!1,left:n.Q.x2,top:n.Q.y2,strokeWidth:1,radius:16,fill:"#57b857",stroke:"#57b857",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:0},s={objectCaching:!1,width:10,height:10,left:n.Q.x2,top:n.Q.y2,strokeWidth:1,fill:"#000",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1},c=this.arrowHead=new d.Triangle(s);this.isValidHeadConnectionMask=new d.Circle(t),c.on("moving",function(){e.updatePath("end",c.left,c.top,!1),e._checkExtremityCanBeConnected("end")}),c.on("moved",function(){e.updatePath("end",c.left,c.top,!0),e.isValidHeadConnectionMask.set("opacity",0),e._connectDisconnectExtremity("end")}),c.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),c.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})});var n={objectCaching:!1,width:10,height:10,left:n.M.x,top:n.M.y,strokeWidth:1,fill:"#fff",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1},h=this.arrowTail=new d.Rect(n);this.isValidTailConnectionMask=new d.Circle(t),h.on("moving",function(){e.updatePath("start",h.left,h.top,!1),e._checkExtremityCanBeConnected("start")}),h.on("moved",function(){e.updatePath("start",h.left,h.top,!0),e.isValidTailConnectionMask.set("opacity",0),e._connectDisconnectExtremity("start")}),h.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),h.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})})}var t,e,n;return t=l,(e=[{key:"inject",value:function(){var t=this.id,e=this.canvas,n=this.path,i=this.controlPoint,a=this.controlLine1,o=this.controlLine2,r=this.arrowHead,s=this.arrowTail,c=this.isValidTailConnectionMask,h=this.isValidHeadConnectionMask;return e.add(i),e.add(a),e.add(o),e.add(c),e.add(h),e.add(r),e.add(s),e.add(n),this.updatePath("start",n.path[0][1],n.path[0][2],!0),this.updatePath("end",n.path[1][3],n.path[1][4],!0),this.updatePath("control",n.path[1][1],n.path[1][2],!0),e.links[t]=this}},{key:"connectLink",value:function(t,e,n){var i,a=this;this.isValidConnection(t,e,n)&&(i=this.canvas.getObjects().find(function(t){return t.id===e}),this.disconnectLink(t),this[t]={shape:i,anchor:n,handlers:{onAnchorPositionModifying:function(){a.updatePath(t,i.anchors[n].left,i.anchors[n].top,!1)},onAnchorPositionModified:function(){a.updatePath(t,i.anchors[n].left,i.anchors[n].top,!0)}}},i.anchors[n].on("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),i.anchors[n].on("pg:position:modified",this[t].handlers.onAnchorPositionModified),this.updatePath(t,i.anchors[n].left,i.anchors[n].top,!0,!1))}},{key:"disconnectLink",value:function(t){this[t]&&(this[t].shape.anchors[this[t].anchor].off("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),this[t].shape.anchors[this[t].anchor].off("pg:position:modified",this[t].handlers.onAnchorPositionModified),delete this[t])}},{key:"resetCurvature",value:function(){var t=this.controlPoint,e=this.path;t.left=(e.path[0][1]+e.path[1][3])/2,t.top=(e.path[0][2]+e.path[1][4])/2,t.setCoords(),t.fire("moved")}},{key:"bringToFront",value:function(){var t=this.canvas,e=this.path,n=this.controlPoint,i=this.arrowHead,a=this.arrowTail;t.bringToFront(e),t.bringToFront(n),t.bringToFront(i),t.bringToFront(a)}},{key:"updatePath",value:function(t,e,n,i,a){var o,e={M:{x:"start"===t?e:this.path.path[0][1],y:"start"===t?n:this.path.path[0][2]},Q:{x1:"control"===t?e:this.path.path[1][1],y1:"control"===t?n:this.path.path[1][2],x2:"end"===t?e:this.path.path[1][3],y2:"end"===t?n:this.path.path[1][4]}};i?(t="M ".concat(e.M.x," ").concat(e.M.y," Q ").concat(e.Q.x1,", ").concat(e.Q.y1,", ").concat(e.Q.x2,", ").concat(e.Q.y2),n=new d.Path(t,this.defaultPathOptions),this.canvas.remove(this.path),this.canvas.add(n),n.on("mouseover",this.onLinkMouseOver.bind(this)),n.on("mouseout",this.onLinkMouseOut.bind(this)),n.on("mousedown",this.bringToFront.bind(this)),n.on("moving",this.onLinkMoving.bind(this)),n.on("moved",this.onLinkMoved.bind(this)),i=[this.arrowHead,this.arrowTail,this.controlPoint,this.controlLine1,this.controlLine2],t=n.calcTransformMatrix(),o=d.util.invertTransform(t),i.forEach(function(t){var e=d.util.multiplyTransformMatrices(o,t.calcTransformMatrix());t.relationship=e}),this.path=n):this.path.set("path",[["M",e.M.x,e.M.y],["Q",e.Q.x1,e.Q.y1,e.Q.x2,e.Q.y2]]),this.controlLine1.set({x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.path.path[0][1],y2:this.path.path[0][2]}),this.controlLine2.set({x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.path.path[1][3],y2:this.path.path[1][4]});e=180*Math.atan2(this.path.path[1][4]-this.path.path[1][2],this.path.path[1][3]-this.path.path[1][1])/Math.PI;this.arrowHead.angle=90+e,this.arrowHead.left=this.path.path[1][3],this.arrowHead.top=this.path.path[1][4],this.arrowHead.setCoords(),this.arrowTail.left=this.path.path[0][1],this.arrowTail.top=this.path.path[0][2],this.arrowTail.setCoords(),this.bringToFront(),a&&this.resetCurvature()}},{key:"isValidConnection",value:function(t,e,n){var i=this.canvas.getObjects().find(function(t){return t.id===e});if("start"===t){if(this.start&&this.start.shape&&this.start.shape.id===i.id&&this.start.cardinal===n)return!1;if(this.end&&this.end.shape&&this.end.shape.id===i.id)return!1}else if("end"===t){if(this.end&&this.end.shape&&this.end.shape.id===i.id&&this.end.cardinal===n)return!1;if(this.start&&this.start.shape&&this.start.shape.id===i.id)return!1}return!0}},{key:"toggleAllAnchorsOpacity",value:function(t){for(var e=this.canvas.getObjects().filter(function(t){return"anchor"===t.type}),n=0;n<e.length;n+=1)e[n].set("opacity",t);this.canvas.renderAll()}},{key:"onLinkMouseOver",value:function(){this.controlPoint.toggleOpacity(1),this.controlLine1.toggleOpacity(1),this.controlLine2.toggleOpacity(1)}},{key:"onLinkMouseOut",value:function(){this.controlPoint.toggleOpacity(0),this.controlLine1.toggleOpacity(0),this.controlLine2.toggleOpacity(0)}},{key:"onLinkMoving",value:function(){var n=this;[this.arrowHead,this.arrowTail,this.controlPoint,this.controlLine1,this.controlLine2].forEach(function(t){var e;t.relationship&&(e=t.relationship,e=d.util.multiplyTransformMatrices(n.path.calcTransformMatrix(),e),e=d.util.qrDecompose(e),t.set({flipX:!1,flipY:!1}),t.setPositionByOrigin({x:e.translateX,y:e.translateY},"center","center"),t.set(e),t.setCoords())}),this._checkExtremityCanBeConnected("start"),this._checkExtremityCanBeConnected("end")}},{key:"onLinkMoved",value:function(){var t={M:{x:this.arrowTail.left,y:this.arrowTail.top},Q:{x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.arrowHead.left,y2:this.arrowHead.top}},t="M ".concat(t.M.x," ").concat(t.M.y," Q ").concat(t.Q.x1,", ").concat(t.Q.y1,", ").concat(t.Q.x2,", ").concat(t.Q.y2),t=new d.Path(t,{});this.updatePath("start",t.path[0][1],t.path[0][2],!1),this.updatePath("end",t.path[1][3],t.path[1][4],!1),this.updatePath("control",t.path[1][1],t.path[1][2],!0),this.isValidTailConnectionMask.set("opacity",0),this.isValidHeadConnectionMask.set("opacity",0),this._connectDisconnectExtremity("start"),this._connectDisconnectExtremity("end")}},{key:"_checkExtremityCanBeConnected",value:function(t){var e,n,i=this.canvas;"start"===t?(e=this.arrowTail,n=this.isValidTailConnectionMask):"end"===t&&(e=this.arrowHead,n=this.isValidHeadConnectionMask),n.left=e.left,n.top=e.top,n.setCoords(),n.set("opacity",0);var a=i.getObjects().filter(function(t){return"anchor"===t.type});e.set("stroke","#000");for(var o=0;o<a.length;o+=1)e.intersectsWithObject(a[o])&&(n.set("opacity",.5),this.isValidConnection(t,a[o].shapeId,a[o].cardinal)?(n.set({stroke:"#57b857",fill:"#57b857"}),e.set("stroke","#5f5")):(n.set({stroke:"#ea4f37",fill:"#ea4f37"}),e.set("stroke","#ea4f37")))}},{key:"_connectDisconnectExtremity",value:function(t){var e,n=this.canvas;"start"===t?e=this.arrowTail:"end"===t&&(e=this.arrowHead);for(var i=n.getObjects().filter(function(t){return"anchor"===t.type}),a=0;a<i.length;a+=1)e.intersectsWithObject(i[a])?(this.connectLink(t,i[a].shapeId,i[a].cardinal),e.set("stroke","#000")):this[t]&&i[a]===this[t].shape.anchors[this[t].anchor]&&this.disconnectLink(t)}}])&&i(t.prototype,e),n&&i(t,n),l}();n.default=a},{}],6:[function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var p=window.fabric,a=function(){function d(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var n=t.id,a=t.canvas,o=t.shape,i=t.left,r=t.top,s=t.angle;this.options=t,this.id=n,this.canvas=a,o.set("type","linkableShape"),o.set({left:i,top:r,id:n,angle:s}),this.shape=o;var c=new p.Rect({left:0,top:0,originX:"center",originY:"center",strokeWidth:1,stroke:"#666",fill:"#fff",width:70,height:20,vented:!1,selectable:!1,opacity:0}),h=new p.Text("0, 0",{left:0,top:0,originX:"center",originY:"center",fontFamily:"Helvetica",fontSize:12,borderStrokeWidth:4,evented:!1,selectable:!1,opacity:0}),l=this.modBox=new p.Group([c,h],{left:0,top:0,originX:"center",originY:"center",evented:!1,selectable:!1});o.on({moving:function(){var t=o.aCoords.tl,e=t.x,n=t.y,i=[o.aCoords.tl.x,o.aCoords.tr.x,o.aCoords.bl.x,o.aCoords.br.x],t=[o.aCoords.tl.y,o.aCoords.tr.y,o.aCoords.bl.y,o.aCoords.br.y];l.left=(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2,l.top=Math.round(Math.max.apply(Math,t)+30),l.setCoords(),c.set("opacity",.7),h.set("opacity",1),h.set("text","".concat(Math.round(e),", ").concat(Math.round(n))),a.bringToFront(l)},moved:function(){c.set("opacity",0),h.set("opacity",0)},rotating:function(){var t=[o.aCoords.tl.x,o.aCoords.tr.x,o.aCoords.bl.x,o.aCoords.br.x],e=[o.aCoords.tl.y,o.aCoords.tr.y,o.aCoords.bl.y,o.aCoords.br.y];l.left=(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,l.top=Math.round(Math.max.apply(Math,e)+30),l.setCoords(),c.set("opacity",.7),h.set("opacity",1),h.set("text","".concat(Math.round(180<o.angle?o.angle-360:o.angle),"°")),a.bringToFront(l)},rotated:function(){c.set("opacity",0),h.set("opacity",0)}}),this.anchors=this.shape.anchors={east:this._makeAnchorPoint("east"),west:this._makeAnchorPoint("west")},o.on({selected:function(){e.toggleAnchorsOpacity(1)},mouseover:function(){e.canvas.getActiveObject()!==e.shape&&e.toggleAnchorsOpacity(1)},mouseout:function(){e.toggleAnchorsOpacity(1)},modifying:function(){e.refreshAnchorsPosition(!1)},modified:function(){e.refreshAnchorsPosition(!0)},moving:function(){e.refreshAnchorsPosition(!1)},moved:function(){e.refreshAnchorsPosition(!0)},rotating:function(){e.refreshAnchorsPosition(!1)},rotated:function(){e.refreshAnchorsPosition(!0)},scaling:function(){e.refreshAnchorsPosition(!1)},scaled:function(){e.refreshAnchorsPosition(!0)}})}var t,e,n;return t=d,(e=[{key:"inject",value:function(){var t=this.id,e=this.canvas,n=this.shape,i=this.anchors,a=this.modBox;return e.add(n),e.add(a),Object.keys(i).forEach(function(t){e.add(i[t]),e.bringForward(i[t],!0)}),this.refreshAnchorsPosition(!0),e.linkableShapes[t]=this}},{key:"remove",value:function(){var t=this.id,e=this.canvas,n=this.shape,i=this.anchors,a=this.modBox;e.remove(n),e.remove(a),Object.keys(i).forEach(function(t){e.remove(i[t])}),delete e.linkableShapes[t]}},{key:"move",value:function(t,e){var n=this.canvas,i=this.shape,a=t.x||i.left,o=t.y||i.top;this.shape.set("left",a),this.shape.set("top",o),this.shape.setCoords(),this.refreshAnchorsPosition(),this.shape.fire(t.moving?"moving":"moved");i.setCoords();var r=!1;if(!t.skipCollision)for(var s=Object.values(n.linkableShapes),c=0;c<s.length;c+=1){var h,l,d,p,u,f,y,g=s[c].shape;g!==i&&i.intersectsWithObject(g)&&(r=!0,h=i.aCoords.bl.y,l=i.aCoords.tl.y,d=i.aCoords.tr.x,p=i.aCoords.tl.x,u=g.aCoords.bl.y,f=g.aCoords.tl.y,y=g.aCoords.tr.x,g=g.aCoords.tl.x,10<h-f?o=f-i.height-10:l-u<10?o=u+10:10<d-g?a=g-i.width-10:p-y<10&&(a=y+10))}e=e||0;r&&e<100&&this.move({x:a,y:o,moving:t.moving},e+=1)}},{key:"rotate",value:function(t){this.shape.rotate(t),this.shape.setCoords(),this.refreshAnchorsPosition()}},{key:"refreshAnchorsPosition",value:function(e){var n=this;Object.keys(this.anchors).forEach(function(t){n._setAnchorPositionRelativeToRectangle(t,e)})}},{key:"toggleAnchorsOpacity",value:function(e){var n=this;Object.keys(this.anchors).forEach(function(t){n.anchors[t].toggleOpacity(e)})}},{key:"bringToFront",value:function(){var e=this.canvas,t=this.shape,n=this.modBox,i=this.anchors;t.bringToFront(),n.bringToFront(),Object.keys(i).forEach(function(t){e.bringToFront(i[t])})}},{key:"_setAnchorPositionRelativeToRectangle",value:function(t,e){var n,i,a=this.shape,o=this.anchors[t];switch(t){case"east":n=(a.aCoords.tr.x+a.aCoords.br.x)/2,i=(a.aCoords.tr.y+a.aCoords.br.y)/2;break;case"west":n=(a.aCoords.tl.x+a.aCoords.bl.x)/2,i=(a.aCoords.tl.y+a.aCoords.bl.y)/2;break;case"north":n=(a.aCoords.tl.x+a.aCoords.tr.x)/2,i=(a.aCoords.tl.y+a.aCoords.tr.y)/2;break;case"south":n=(a.aCoords.bl.x+a.aCoords.br.x)/2,i=(a.aCoords.bl.y+a.aCoords.br.y)/2;break;case"northeast":n=a.aCoords.tr.x,i=a.aCoords.tr.y;break;case"northwest":n=a.aCoords.tl.x,i=a.aCoords.tl.y;break;case"southeast":n=a.aCoords.br.x,i=a.aCoords.br.y;break;default:n=a.aCoords.bl.x,i=a.aCoords.bl.y}o.left=n,o.top=i,o.setCoords(),o.fire(e?"pg:position:modified":"pg:position:modifying")}},{key:"_makeAnchorPoint",value:function(t){var e,n,i=this,a=this.shape,o=this.id,r=this.canvas;switch(t){case"east":e=(a.aCoords.tr.x+a.aCoords.br.x)/2,n=(a.aCoords.tr.y+a.aCoords.br.y)/2;break;case"west":e=(a.aCoords.tl.x+a.aCoords.bl.x)/2,n=(a.aCoords.tl.y+a.aCoords.bl.y)/2;break;case"north":e=(a.aCoords.tl.x+a.aCoords.tr.x)/2,n=(a.aCoords.tl.y+a.aCoords.tr.y)/2;break;case"south":e=(a.aCoords.bl.x+a.aCoords.br.x)/2,n=(a.aCoords.bl.y+a.aCoords.br.y)/2;break;case"northeast":e=a.aCoords.tr.x,n=a.aCoords.tr.y;break;case"northwest":e=a.aCoords.tl.x,n=a.aCoords.tl.y;break;case"southeast":e=a.aCoords.br.x,n=a.aCoords.br.y;break;default:e=a.aCoords.bl.x,n=a.aCoords.bl.y}var s=new p.Rect({objectCaching:!1,width:10,height:10,left:e,top:n,strokeWidth:1,fill:"#ddd",stroke:"#999",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:1,id:"".concat(o,"_").concat(t)});return s.type="anchor",s.shapeId=o,s.cardinal=t,s.on("mouseover",function(){s.set("fill","#78befa"),s.set("stroke","#78befa"),r.renderAll()}),s.on("mouseout",function(){s.set("fill","#ddd"),s.set("stroke","#999"),r.renderAll()}),s.on("mousedown",function(t){switch(t.button){case 3:i._onAnchorRightClick.call(i,t);break;case 2:i._onAnchorMiddleClick.call(i,t);break;default:i._onAnchorLeftClick.call(i,t)}}),s}},{key:"_onAnchorLeftClick",value:function(){}},{key:"_onAnchorMiddleClick",value:function(){}},{key:"_onAnchorRightClick",value:function(){}}])&&i(t.prototype,e),n&&i(t,n),d}();n.default=a},{}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var d=i(t("./ExpandableContainer.js")),p=i(t("./CurvedLink.js"));function i(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n,i,a,o,r){try{var s=t[o](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,a)}function u(s){return function(){var t=this,r=arguments;return new Promise(function(e,n){var i=s.apply(t,r);function a(t){c(i,e,n,a,o,"next",t)}function o(t){c(i,e,n,a,o,"throw",t)}a(void 0)})}}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var t=window,y=t.fabric,g=t._,t=function(){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.handlers={grid:{}},this.tempDraggedObject=null,this.selectedChooserType=null;var e=this.canvas=t.canvas||new y.Canvas(t.canvasOpts.el,t.canvasOpts.options);e.set("preserveObjectStacking",!0),e.set("fireRightClick",!0),e.set("fireMiddleClick",!0),e.set("stopContextMenu",!0),e.linkableShapes={},e.links={},"number"==typeof t.grid&&this.setGrid({grid:t.grid}),y.Object.prototype.toggleOpacity=function(t){this.set("opacity",t),this.canvas.renderAll()},e.calcOffset();t=function(){var t=e.getActiveObject();"activeSelection"!==t.type||1<(t=t.getObjects()).length&&(t=t.filter(function(t){return"linkableShape"===t.type}),e._discardActiveObject(),t=new y.ActiveSelection(t,{canvas:e}),e._setActiveObject(t))};e.on({"selection:created":t,"selection:updated":t,dragenter:this.onDragEnter.bind(this),dragover:this.onDragOver.bind(this),dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})}var t,e,i,a,o,r,s,c,h,l;return t=n,(e=[{key:"setGrid",value:function(t){var p=this;if("number"!=typeof t.grid||t.grid<0)throw new Error('Invalid argument "grid" in ProcessGrap#setGrid. (required: Number > 0)');this.grid=t.grid;var n=this.canvas,e='<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">         <defs>             <pattern id="smallGrid" width="'.concat(this.grid,'" height="').concat(this.grid,'" patternUnits="userSpaceOnUse">                 <path d="M ').concat(this.grid," 0 L 0 0 0 ").concat(this.grid,'" fill="none" stroke="gray" stroke-width="0.5" />             </pattern>             <pattern id="grid" width="').concat(5*this.grid,'" height="').concat(5*this.grid,'" patternUnits="userSpaceOnUse">                 <rect width="').concat(5*this.grid,'" height="').concat(5*this.grid,'" fill="url(#smallGrid)" />                 <path d="M ').concat(5*this.grid," 0 L 0 0 0 ").concat(5*this.grid,'" fill="none" stroke="gray" stroke-width="1" />             </pattern>         </defs>         <rect width="100%" height="100%" fill="url(#grid)" />     </svg>'),t=window.URL||window.webkitURL||window,e=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),e=t.createObjectURL(e);y.util.loadImage(e,function(t){var e=new y.Rect({width:n.width,height:n.height,evented:!1,selectable:!1});e.fill=new y.Pattern({source:t},function(){e.dirty=!0,n.requestRenderAll()}),(e.canvas=n).set("backgroundImage",e),n.off(p.handlers.grid),p.handlers.grid={"object:moving":function(t){var e=p.grid,t=t.target;"linkableShape"===t.type&&n.linkableShapes[t.id].move({x:Math.round(t.left/e)*e,y:Math.round(t.top/e)*e,moving:!0})},"object:scaling":function(t){var e=p.grid,n=t.target;if("linkableShape"===n.type){var i=n.width*n.scaleX,a=n.height*n.scaleY,o={top:Math.round(n.top/e)*e,left:Math.round(n.left/e)*e,bottom:Math.round((n.top+a)/e)*e,right:Math.round((n.left+i)/e)*e},r=e,s=Math.abs(o.top-n.top),c=Math.abs(o.left-n.left),h=Math.abs(o.bottom-n.top-a),l=Math.abs(o.right-n.left-i),d={scaleX:n.scaleX,scaleY:n.scaleY,top:n.top,left:n.left};switch(n.__corner){case"tl":c<s&&c<r?(d.scaleX=(i-(o.left-n.left))/n.width,d.scaleY=d.scaleX/n.scaleX*n.scaleY,d.top=n.top+(a-n.height*d.scaleY),d.left=o.left):s<r&&(d.scaleY=(a-(o.top-n.top))/n.height,d.scaleX=d.scaleY/n.scaleY*n.scaleX,d.left+=i-n.width*d.scaleX,d.top=o.top);break;case"mt":s<r&&(d.scaleY=(a-(o.top-n.top))/n.height,d.top=o.top);break;case"tr":l<s&&l<r?(d.scaleX=(o.right-n.left)/n.width,d.scaleY=d.scaleX/n.scaleX*n.scaleY,d.top=n.top+(a-n.height*d.scaleY)):s<r&&(d.scaleY=(a-(o.top-n.top))/n.height,d.scaleX=d.scaleY/n.scaleY*n.scaleX,d.top=o.top);break;case"ml":c<r&&(d.scaleX=(i-(o.left-n.left))/n.width,d.left=o.left);break;case"mr":l<r&&(d.scaleX=(o.right-n.left)/n.width);break;case"bl":c<h&&c<r?(d.scaleX=(i-(o.left-n.left))/n.width,d.scaleY=d.scaleX/n.scaleX*n.scaleY,d.left=o.left):h<r&&(d.scaleY=(o.bottom-n.top)/n.height,d.scaleX=d.scaleY/n.scaleY*n.scaleX,d.left+=i-n.width*d.scaleX);break;case"mb":h<r&&(d.scaleY=(o.bottom-n.top)/n.height);break;default:l<h&&l<r?(d.scaleX=(o.right-n.left)/n.width,d.scaleY=d.scaleX/n.scaleX*n.scaleY):h<r&&(d.scaleY=(o.bottom-n.top)/n.height,d.scaleX=d.scaleY/n.scaleY*n.scaleX)}n.set(d),n.setCoords()}}},0<p.grid&&n.on(p.handlers.grid)})}},{key:"load",value:(l=u(regeneratorRuntime.mark(function t(e){var n,i,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=this.canvas,i=0;case 2:if(i<e.containers.length)return(o=g.cloneDeep(e.containers[i])).canvas=n,t.next=7,this.addContainer(o);t.next=10;break;case 7:i+=1,t.next=2;break;case 10:a=0;case 11:if(a<e.links.length)return(o=g.cloneDeep(e.links[a])).canvas=n,t.next=16,this.addLink(o);t.next=19;break;case 16:a+=1,t.next=11;break;case 19:case"end":return t.stop()}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"addContainer",value:(h=u(regeneratorRuntime.mark(function t(e){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.canvas,i={id:e.id,canvas:n,left:e.left||0,top:e.top||0,angle:0,label:e.label,img:{src:e.img.src},childWidth:72,childHeight:42,children:Array.isArray(e.children)?e.children:[]},i=new d.default(i),t.next=5,i.load();case 5:return i.collapse(),i.inject(),e.isTemporary&&i.shape.set("opacity",.5),e.x&&e.y&&i.move({x:e.x,y:e.y,moving:!1}),n.linkableShapes[e.id]=i,t.abrupt("return",i);case 11:case"end":return t.stop()}},t,this)})),function(t){return h.apply(this,arguments)})},{key:"removeContainer",value:function(t){var e=this.canvas;t.id in e.linkableShapes&&e.linkableShapes[t.id].remove()}},{key:"addLink",value:(c=u(regeneratorRuntime.mark(function t(e){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.canvas,i={id:e.id,canvas:n,start:{x:e.start.x||0,y:e.start.y||0},end:{x:e.end.x||0,y:e.end.y||0}},(i=new p.default(i)).inject(n),e.isTemporary||(i.arrowHead.fire("moved"),i.arrowTail.fire("moved"),e.start&&e.start.id&&e.start.cardinal&&i.connectLink("start",e.start.id,e.start.cardinal),e.end&&e.end.id&&e.end.cardinal&&i.connectLink("end",e.end.id,e.end.cardinal)),n.links[e.id]=i,t.abrupt("return",i);case 7:case"end":return t.stop()}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"removeLink",value:function(t){var e=this.canvas;t.id in e.links&&e.links[t.id].remove()}},{key:"expand",value:function(t){var e=this.canvas;t in e.linkableShapes&&e.linkableShapes[t].expand()}},{key:"collapse",value:function(t){var e=this.canvas;t in e.linkableShapes&&e.linkableShapes[t].collapse()}},{key:"setSelectedChooserType",value:function(t){this.selectedChooserType=t}},{key:"onDragEnter",value:(s=u(regeneratorRuntime.mark(function t(e){var n,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=this.canvas.upperCanvasEl.getBoundingClientRect(),n=e.e.x-a.left,i=e.e.y-a.top,a=this.selectedChooserType.id,t.t0=a,t.next="link"===t.t0?7:(t.t0,11);break;case 7:return t.next=9,this.addLink({id:"".concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),x:n,y:i});case 9:return this.tempDraggedObject=t.sent,t.abrupt("break",15);case 11:return t.next=13,this.addContainer({id:"".concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),label:this.selectedChooserType.label,img:{src:this.selectedChooserType.icon},x:0,y:0,isTemporary:!0});case 13:return this.tempDraggedObject=t.sent,t.abrupt("break",15);case 15:e.e.preventDefault();case 16:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"onDragOver",value:(r=u(regeneratorRuntime.mark(function t(e){var n,i,a,o,r,s,c,h,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.canvas,a=this.canvas.upperCanvasEl.getBoundingClientRect(),i=e.e.x-a.left,a=e.e.y-a.top,null===this.tempDraggedObject){t.next=15;break}o=this.selectedChooserType.id,t.t0=o,t.next="link"===t.t0?9:(t.t0,13);break;case 9:return this.tempDraggedObject.updatePath({start:{x:i-50,y:a},end:{x:i+50,y:a},commit:!1}),this.tempDraggedObject.arrowHead.fire("moving"),this.tempDraggedObject.arrowTail.fire("moving"),t.abrupt("break",15);case 13:if(this.tempDraggedObject.isLoaded)for(i-=this.tempDraggedObject.shape.width/2,a-=this.tempDraggedObject.shape.height/2,this.grid&&(o=this.grid,i=Math.round(i/o)*o,a=Math.round(a/o)*o),this.tempDraggedObject.move({x:i,y:a,moving:!0,skipCollision:!0}),r=Object.keys(n.linkableShapes),s=0;s<r.length;s+=1)(c=n.linkableShapes[r[s]]).id!==this.tempDraggedObject.id&&(h=this.tempDraggedObject.shape.left+this.tempDraggedObject.shape.width/2,l=this.tempDraggedObject.shape.top,c.shape.intersectsWithRect(new y.Point(h-5,l),new y.Point(h+5,l+10))?c.setActive(!0):c.setActive(!1));return t.abrupt("break",15);case 15:e.e.preventDefault();case 16:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"onDragLeave",value:(o=u(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===this.tempDraggedObject){t.next=10;break}n=this.selectedChooserType.id,t.t0=n,t.next="link"===t.t0?5:(t.t0,8);break;case 5:return this.removeLink({id:this.tempDraggedObject.id}),this.tempDraggedObject=null,t.abrupt("break",10);case 8:return this.tempDraggedObject.isLoaded&&(this.removeContainer({id:this.tempDraggedObject.id}),this.tempDraggedObject=null),t.abrupt("break",10);case 10:e.e.preventDefault();case 11:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"onDrop",value:(a=u(regeneratorRuntime.mark(function t(e){var n,i,a,o,r,s,c,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=this.canvas,c=this.canvas.upperCanvasEl.getBoundingClientRect(),i=e.e.x-c.left,a=e.e.y-c.top,c=this.selectedChooserType.id,t.t0=c,t.next="link"===t.t0?8:(t.t0,12);break;case 8:return null!==this.tempDraggedObject&&(this.removeLink({id:this.tempDraggedObject.id}),this.tempDraggedObject=null),t.next=11,this.addLink({id:"".concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),x:i,y:a,isTemporary:!1});case 11:return t.abrupt("break",25);case 12:for(o=Object.keys(n.linkableShapes),r=0;r<o.length;r+=1)(s=n.linkableShapes[o[r]]).id!==this.tempDraggedObject.id&&(s.setActive(!1),s.shape.intersectsWithObject(this.tempDraggedObject.shape)&&console.log("add as children"));return null!==this.tempDraggedObject&&(this.removeContainer({id:this.tempDraggedObject.id}),this.tempDraggedObject=null),h={id:"".concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),label:this.selectedChooserType.label,img:{src:this.selectedChooserType.icon},x:i,y:a,isTemporary:!1},t.next=18,this.addContainer(h);case 18:return c=t.sent,i-=c.shape.width/2,a-=c.shape.height/2,this.grid&&(h=this.grid,i=Math.round(i/h)*h,a=Math.round(a/h)*h),c.move({x:i,y:a,moving:!0}),c.move({moving:!1}),t.abrupt("break",25);case 25:e.e.preventDefault();case 26:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})}])&&f(t.prototype,e),i&&f(t,i),n}();n.default=t},{"./CurvedLink.js":3,"./ExpandableContainer.js":4}]},{},[1]);
//# sourceMappingURL=fabricjs-process-graph.min.js.map