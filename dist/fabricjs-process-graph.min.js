/*! fabricjs-process-graph 25-10-2021 */

!function n(i,a,r){function s(e,t){if(!a[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(c)return c(e,!0);throw(o=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",o}o=a[e]={exports:{}},i[e][0].call(o.exports,function(t){return s(i[e][1][t]||t)},o,o.exports,n,i,a,r)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<r.length;t++)s(r[t]);return s}({1:[function(t,e,o){"use strict";var n=s(t("./src/Container.js")),i=s(t("./src/ProcessGraph.js")),a=s(t("./src/Link.js")),r=s(t("./src/LinkableShape.js")),t=s(t("./src/CurvedLink.js"));function s(t){return t&&t.__esModule?t:{default:t}}window.pg={ProcessGraph:i.default,Container:n.default,Link:a.default,LinkableShape:r.default,CurvedLink:t.default}},{"./src/Container.js":2,"./src/CurvedLink.js":3,"./src/Link.js":4,"./src/LinkableShape.js":5,"./src/ProcessGraph.js":6}],2:[function(t,e,o){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=a(t("./LinkableShape.js")),f=a(t("./CurvedLink.js"));function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=h(o);return function(t,e){{if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined")}return function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t)}(this,n?(t=h(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var t=window,l=t.fabric,u=t._,t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(d,n["default"]);var t,e,o,a=c(d);function d(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var o=new l.Rect({left:0,top:0,originX:"left",originY:"top",strokeWidth:1,stroke:"#000",fill:"#fff",rx:10,ry:10,width:t.width||200,height:t.height||100}),n=new l.Textbox(t.label,{left:o.width/2,top:o.height/2,styles:{},fontSize:14,fontFamily:"Helvetica",textAlign:"center",originX:"center",originY:"center",width:190,height:90,splitByGrapheme:!0}),i=new l.Group([o,n],{left:0,top:0,originX:"left",originY:"top"}),o=u.cloneDeep(u.omit(t,["canvas","shape"]));return o.canvas=t.canvas,o.shape=i,e=a.call(this,o),i.on({scaling:function(){i.scaleX<1?n.scaleX=1-i.scaleX+1:n.scaleX=1/i.scaleX,i.scaleY<1?n.scaleY=1-i.scaleY+1:n.scaleY=1/i.scaleY,e.canvas.renderAll()}}),e}return t=d,(e=[{key:"_onAnchorRightClick",value:function(t){var e=this.shape,o=e.id,n=e.left,i=e.top,a=e.angle,r=e.canvas,s=e.width,c=e.height,e=t.target,t=e.cardinal,o=new d({canvas:r,id:"".concat(o,"_next_").concat(t,"_").concat(Math.floor(65536*(1+Math.random())).toString(16).substring(1)),left:n,top:i,angle:a,label:"".concat(o,"_next_").concat(t)});o.inject();var h,l={};switch(t){case"east":h="west",l.y=i,l.x=n+s+50;break;case"west":h="east",l.y=i,l.x=n-s-50;break;case"north":h="south",l.y=i-c-50,l.x=n;break;case"south":h="north",l.y=i+c+50,l.x=n;break;case"northeast":h="southwest",l.y=i-c-50,l.x=n+s+50;break;case"northwest":h="southeast",l.y=i-c-50,l.x=n-s-50;break;case"southeast":h="northwest",l.x=i+c+50,l.y=n+s+50;break;default:h="northeast",l.y=i+c+50,l.x=n-s-50}o.move(l);t=new f.default({canvas:r,start:{x:e.left,y:e.top},end:{x:o.anchors[h].left,y:o.anchors[h].top}});t.inject(r),t.connectLink("start",e.shapeId,e.cardinal),t.connectLink("end",o.anchors[h].shapeId,o.anchors[h].cardinal)}},{key:"_onAnchorLeftClick",value:function(t){var e=this,t=t.target,o=this.canvas;this.canvas.selection=!1;var n=new f.default({canvas:o,start:{x:t.left,y:t.top,direction:t.cardinal},end:{x:t.left,y:t.top,direction:{east:"west",west:"east",north:"south",south:"north"}[t.cardinal]}});n.inject(o),n.connectLink("start",t.shapeId,t.cardinal),n.arrowHead.fire("mousedown");var i=function(t){n.arrowHead.left=t.pointer.x,n.arrowHead.top=t.pointer.y,n.arrowHead.fire("moving")};o.on("mouse:move",i);t=function t(){e.canvas.selection=!0,n.arrowHead.fire("moved"),n.arrowHead.fire("mouseup"),o.off("mouse:move",i),o.off("mouse:up",t)};o.on("mouse:up",t)}}])&&r(t.prototype,e),o&&r(t,o),d}();o.default=t},{"./CurvedLink.js":3,"./LinkableShape.js":5}],3:[function(t,e,o){"use strict";function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var c=window.fabric,i=function(){function s(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var o=t.id,n=t.canvas;this.id=o,this.canvas=n,this.direction={start:t&&t.start&&t.start.direction?t.start.direction:"east",end:t&&t.end&&t.end.direction?t.end.direction:"west"};var i={x:t&&t.start&&t.start.x?t.start.x:0,y:t&&t.start&&t.start.y?t.start.y:0},o={x:t&&t.end&&t.end.x?t.end.x:0,y:t&&t.end&&t.end.y?t.end.y:0},n=this.computePathCoords({start:{x:i.x,y:i.y,direction:this.direction.start},end:{x:o.x,y:o.y,direction:this.direction.end}}).pathCoordsArray,t=this.defaultPathOptions={fill:"",stroke:t.custom&&t.custom.path&&t.custom.path.stroke?t.custom.path.stroke:"#000",strokeWidth:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.strokeWidth:2,objectCaching:!1,selectable:!0,hasBorders:!0,hasControls:!1,perPixelTargetFind:!0},t=new c.Path(n,t);this.path=t;var t={objectCaching:!1,left:0,top:0,strokeWidth:1,radius:16,fill:"#57b857",stroke:"#57b857",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:0},a=this.arrowHead=new c.Triangle({objectCaching:!1,width:10,height:10,left:o.x,top:o.y,strokeWidth:1,fill:"#000",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1});this.isValidHeadConnectionMask=new c.Circle(t),a.on("moving",function(){e.updatePath({end:{x:a.left,y:a.top},commit:!1}),e._checkExtremityCanBeConnected("end")}),a.on("moved",function(){e.updatePath({end:{x:a.left,y:a.top},commit:!0}),e.isValidHeadConnectionMask.set("opacity",0),e._connectDisconnectExtremity("end")}),a.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),a.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})});var r=this.arrowTail=new c.Rect({objectCaching:!1,width:10,height:10,left:i.x,top:i.y,strokeWidth:1,fill:"#fff",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1});this.isValidTailConnectionMask=new c.Circle(t),r.on("moving",function(){e.updatePath({start:{x:r.left,y:r.top},commit:!1}),e._checkExtremityCanBeConnected("start")}),r.on("moved",function(){e.updatePath({start:{x:r.left,y:r.top},commit:!0}),e.isValidTailConnectionMask.set("opacity",0),e._connectDisconnectExtremity("start")}),r.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),r.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})})}var t,e,o;return t=s,(e=[{key:"inject",value:function(){var t=this.canvas,e=this.path,o=this.arrowHead,n=this.arrowTail,i=this.isValidTailConnectionMask,a=this.isValidHeadConnectionMask;return t.add(i),t.add(a),t.add(o),t.add(n),t.add(e),this.updatePath({start:{x:e.path[0][1],y:e.path[0][2]},end:{x:e.path[2][5],y:e.path[2][6]},commit:!0}),this}},{key:"connectLink",value:function(e,o,n){var i,t,a=this;this.isValidConnection(e,o,n)&&(i=this.canvas.getObjects().find(function(t){return t.id===o}),this.disconnectLink(e),this.direction[e]=n,this[e]={shape:i,anchor:n,handlers:{onAnchorPositionModifying:function(){var t={commit:!1};t[e]={x:i.anchors[n].left,y:i.anchors[n].top},a.updatePath(t)},onAnchorPositionModified:function(){var t={commit:!0};t[e]={x:i.anchors[n].left,y:i.anchors[n].top},a.updatePath(t)}}},i.anchors[n].opacity=0,i.anchors[n].on("pg:position:modifying",this[e].handlers.onAnchorPositionModifying),i.anchors[n].on("pg:position:modified",this[e].handlers.onAnchorPositionModified),(t={commit:!1})[e]={x:i.anchors[n].left,y:i.anchors[n].top},this.updatePath(t))}},{key:"disconnectLink",value:function(t){this[t]&&(this[t].shape.anchors[this[t].anchor].off("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),this[t].shape.anchors[this[t].anchor].off("pg:position:modified",this[t].handlers.onAnchorPositionModified),delete this[t])}},{key:"bringToFront",value:function(){var t=this.canvas,e=this.path,o=this.arrowHead,n=this.arrowTail;t.bringToFront(e),t.bringToFront(o),t.bringToFront(n)}},{key:"computePathCoords",value:function(t){var e,o,n={x:t.start.x,y:t.start.y,direction:t.start&&t.start.direction?t.start.direction:this.direction.start},i={x:t.end.x,y:t.end.y,direction:t.end&&t.end.direction?t.end.direction:this.direction.end},a={x:(n.x+i.x)/2,y:(n.y+i.y)/2},r={start:{x:n.x,y:n.y},end:{x:i.x,y:i.y},center1:{x:a.x,y:a.y},center2:{x:a.x,y:a.y}};switch(t.start.direction){case"north":r.start.y-=Math.abs(n.y-a.y);break;case"south":r.start.y+=Math.abs(n.y-a.y);break;case"east":r.start.x+=Math.abs(n.x-a.x);break;default:r.start.x-=Math.abs(n.x-a.x)}switch(t.end.direction){case"north":r.end.y-=Math.abs(i.y-a.y);break;case"south":r.end.y+=Math.abs(i.y-a.y);break;case"east":r.end.x+=Math.abs(i.x-a.x);break;default:r.end.x-=Math.abs(i.x-a.x)}n.direction===i.direction?"south"===n.direction||"north"===n.direction?(this.start&&this.end&&Math.abs(n.y-i.y)<10&&(a.x-=(this.start.shape.width+this.end.shape.width)/2),a.y+="south"===n.direction?40:-40,r.start.y=n.y+("south"===n.direction?40:-40),r.end.y=i.y+("south"===n.direction?40:-40),r.center1.x=a.x,r.center2.x=a.x,r.center1.y=r.start.y,r.center2.y=r.end.y):"east"!==n.direction&&"west"!==n.direction||(this.start&&this.end&&Math.abs(n.y-i.y)<10&&(a.y-=(this.start.shape.height+this.end.shape.height)/2),a.x+="east"===n.direction?40:-40,r.start.x=n.x+("east"===n.direction?40:-40),r.end.x=i.x+("east"===n.direction?40:-40),r.center1.x=r.start.x,r.center2.x=r.end.x,r.center1.y=a.y,r.center2.y=a.y):"south"===n.direction||"north"===n.direction?(r.center1.x=a.x,r.center1.y=r.start.y,r.center2.x=a.x,r.center2.y=r.end.y):"east"!==n.direction&&"west"!==n.direction||(r.center1.x=r.start.x,r.center1.y=a.y,r.center2.x=r.end.x,r.center2.y=a.y),this.start&&this.start.shape&&this.start.shape.angle&&(e=this.start.shape.angle*Math.PI/180,t=new c.Point(r.start.x,r.start.y),o=new c.Point(n.x,n.y),o=c.util.rotatePoint(t,o,e),r.start.x=o.x,r.start.y=o.y),this.end&&this.end.shape&&this.end.shape.angle&&(s=this.end.shape.angle*Math.PI/180,e=new c.Point(r.end.x,r.end.y),o=new c.Point(i.x,i.y),s=c.util.rotatePoint(e,o,s),r.end.x=s.x,r.end.y=s.y);var s={start:{x:n.x,y:n.y},end:{x:i.x,y:i.y},center:a,controls:{start:{x:r.start.x,y:r.start.y},end:{x:r.end.x,y:r.end.y},center1:{x:r.center1.x,y:r.center1.y},center2:{x:r.center2.x,y:r.center2.y}}};return{pathCoords:s,pathCoordsArray:[["M",s.start.x,s.start.y],["C",s.controls.start.x,s.controls.start.y,s.controls.center1.x,s.controls.center1.y,s.center.x,s.center.y],["C",s.controls.center2.x,s.controls.center2.y,s.controls.end.x,s.controls.end.y,s.end.x,s.end.y]]}}},{key:"updatePath",value:function(t){var o,e={x:t.start&&t.start.x?t.start.x:this.path.path[0][1],y:t.start&&t.start.y?t.start.y:this.path.path[0][2],direction:t.start&&t.start.direction?t.start.direction:this.direction.start},n={x:t.end&&t.end.x?t.end.x:this.path.path[2][5],y:t.end&&t.end.y?t.end.y:this.path.path[2][6],direction:t.end&&t.end.direction?t.end.direction:this.direction.end},i=this.computePathCoords({start:e,end:n}).pathCoordsArray;t.commit?(e=new c.Path(i,this.defaultPathOptions),this.canvas.remove(this.path),this.canvas.add(e),e.on("mousedown",this.bringToFront.bind(this)),e.on("moving",this.onLinkMoving.bind(this)),e.on("moved",this.onLinkMoved.bind(this)),n=[this.arrowHead,this.arrowTail],t=e.calcTransformMatrix(),o=c.util.invertTransform(t),n.forEach(function(t){var e=c.util.multiplyTransformMatrices(o,t.calcTransformMatrix());t.relationship=e}),this.path=e):this.path.set("path",i);i=180*Math.atan2(this.path.path[2][6]-this.path.path[2][4],this.path.path[2][5]-this.path.path[2][3])/Math.PI;this.arrowHead.angle=90+i,this.arrowHead.left=this.path.path[2][5],this.arrowHead.top=this.path.path[2][6],this.arrowHead.setCoords(),this.arrowTail.left=this.path.path[0][1],this.arrowTail.top=this.path.path[0][2],this.arrowTail.setCoords(),this.bringToFront()}},{key:"isValidConnection",value:function(t,e,o){var n=this.canvas.getObjects().find(function(t){return t.id===e});if("start"===t){if(this.start&&this.start.shape&&this.start.shape.id===n.id&&this.start.cardinal===o)return!1;if(this.end&&this.end.shape&&this.end.shape.id===n.id)return!1}else if("end"===t){if(this.end&&this.end.shape&&this.end.shape.id===n.id&&this.end.cardinal===o)return!1;if(this.start&&this.start.shape&&this.start.shape.id===n.id)return!1}return!0}},{key:"toggleAllAnchorsOpacity",value:function(t){for(var e=this.canvas.getObjects().filter(function(t){return"anchor"===t.type}),o=0;o<e.length;o+=1)e[o].set("opacity",t);this.canvas.renderAll()}},{key:"onLinkMoving",value:function(){var o=this,t=[this.arrowHead,this.arrowTail],n=this.arrowHead.angle,i=this.arrowTail.angle;t.forEach(function(t){var e;t.relationship&&(e=t.relationship,e=c.util.multiplyTransformMatrices(o.path.calcTransformMatrix(),e),e=c.util.qrDecompose(e),t.set({flipX:!1,flipY:!1}),t.setPositionByOrigin({x:e.translateX,y:e.translateY},"center","center"),t.set(e),t.angle=t===o.arrowHead?n:i,t.setCoords())}),this._checkExtremityCanBeConnected("start"),this._checkExtremityCanBeConnected("end")}},{key:"onLinkMoved",value:function(){this.updatePath({start:{x:this.arrowTail.left,y:this.arrowTail.top},end:{x:this.arrowHead.left,y:this.arrowHead.top},commit:!0}),this.isValidTailConnectionMask.set("opacity",0),this.isValidHeadConnectionMask.set("opacity",0),this._connectDisconnectExtremity("start"),this._connectDisconnectExtremity("end")}},{key:"_checkExtremityCanBeConnected",value:function(t){var e,o,n=this.canvas;"start"===t?(e=this.arrowTail,o=this.isValidTailConnectionMask):"end"===t&&(e=this.arrowHead,o=this.isValidHeadConnectionMask),o.left=e.left,o.top=e.top,o.setCoords(),o.set("opacity",0);var i=n.getObjects().filter(function(t){return"anchor"===t.type});e.set("stroke","#000");for(var a,r=0;r<i.length;r+=1)e.intersectsWithObject(i[r])&&(o.set("opacity",.5),this.isValidConnection(t,i[r].shapeId,i[r].cardinal)?(o.set({stroke:"#57b857",fill:"#57b857"}),e.set("stroke","#5f5"),(a={commit:!1})[t]={x:e.left,y:e.top,direction:i[r].cardinal},this.updatePath(a)):(o.set({stroke:"#ea4f37",fill:"#ea4f37"}),e.set("stroke","#ea4f37")))}},{key:"_connectDisconnectExtremity",value:function(t){var e,o=this.canvas;"start"===t?e=this.arrowTail:"end"===t&&(e=this.arrowHead);for(var n=o.getObjects().filter(function(t){return"anchor"===t.type}),i=0;i<n.length;i+=1)e.intersectsWithObject(n[i])?(this.connectLink(t,n[i].shapeId,n[i].cardinal),e.set("stroke","#000")):this[t]&&n[i]===this[t].shape.anchors[this[t].anchor]&&this.disconnectLink(t)}}])&&n(t.prototype,e),o&&n(t,o),s}();o.default=i},{}],4:[function(t,e,o){"use strict";function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var d=window.fabric,i=function(){function l(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l);var o=t.id,n=t.canvas,i=t&&t.start&&t.start.x?t.start.x:0,a=t&&t.start&&t.start.y?t.start.y:0,r=t&&t.end&&t.end.x?t.end.x:0,s=t&&t.end&&t.end.y?t.end.y:0;this.id=o,this.canvas=n;o={M:{x:i,y:a},Q:{x1:(i+r)/2,y1:(a+s)/2,x2:r,y2:s}},n=this.defaultPathOptions={fill:"",stroke:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.stroke:"#000",strokeWidth:t.custom&&t.custom.path&&t.custom.path.strokeWidth?t.custom.path.strokeWidth:2,objectCaching:!1,selectable:!0,hasBorders:!0,hasControls:!1,perPixelTargetFind:!0},t="M ".concat(o.M.x," ").concat(o.M.y," Q ").concat(o.Q.x1,", ").concat(o.Q.y1,", ").concat(o.Q.x2,", ").concat(o.Q.y2),t=new d.Path(t,n);this.path=t;n=this.controlPoint=new d.Circle({objectCaching:!1,left:o.Q.x1,top:o.Q.y1,strokeWidth:1,radius:6,fill:"#78befa",stroke:"#78befa",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!0,opacity:0});n.on("mouseover",this.onLinkMouseOver.bind(this)),n.on("mouseout",this.onLinkMouseOut.bind(this)),n.on("moving",function(){e.updatePath("control",e.controlPoint.left,e.controlPoint.top,!1)}),n.on("moved",function(){e.updatePath("control",e.controlPoint.left,e.controlPoint.top,!0)}),n.on("mousedown",function(){e.bringToFront()});t={objectCaching:!1,strokeDashArray:[5,5],strokeWidth:1,stroke:"#78befa",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,opacity:0},a=this.controlLine1=new d.Line([n.left,n.top,i,a],t);a.on("mouseover",this.onLinkMouseOver.bind(this)),a.on("mouseout",this.onLinkMouseOut.bind(this));s=this.controlLine2=new d.Line([n.left,n.top,r,s],t);s.on("mouseover",this.onLinkMouseOver.bind(this)),s.on("mouseout",this.onLinkMouseOut.bind(this));var t={objectCaching:!1,left:o.Q.x2,top:o.Q.y2,strokeWidth:1,radius:16,fill:"#57b857",stroke:"#57b857",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:0},s={objectCaching:!1,width:10,height:10,left:o.Q.x2,top:o.Q.y2,strokeWidth:1,fill:"#000",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1},c=this.arrowHead=new d.Triangle(s);this.isValidHeadConnectionMask=new d.Circle(t),c.on("moving",function(){e.updatePath("end",c.left,c.top,!1),e._checkExtremityCanBeConnected("end")}),c.on("moved",function(){e.updatePath("end",c.left,c.top,!0),e.isValidHeadConnectionMask.set("opacity",0),e._connectDisconnectExtremity("end")}),c.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),c.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})});var o={objectCaching:!1,width:10,height:10,left:o.M.x,top:o.M.y,strokeWidth:1,fill:"#fff",opacity:1,stroke:"#000",originX:"center",originY:"center",selectable:!0,hasBorders:!1,hasControls:!1},h=this.arrowTail=new d.Rect(o);this.isValidTailConnectionMask=new d.Circle(t),h.on("moving",function(){e.updatePath("start",h.left,h.top,!1),e._checkExtremityCanBeConnected("start")}),h.on("moved",function(){e.updatePath("start",h.left,h.top,!0),e.isValidTailConnectionMask.set("opacity",0),e._connectDisconnectExtremity("start")}),h.on("mousedown",function(){e.bringToFront(),e.toggleAllAnchorsOpacity(1),h.on("mouseup",function(){e.toggleAllAnchorsOpacity(0)})})}var t,e,o;return t=l,(e=[{key:"inject",value:function(){var t=this.canvas,e=this.path,o=this.controlPoint,n=this.controlLine1,i=this.controlLine2,a=this.arrowHead,r=this.arrowTail,s=this.isValidTailConnectionMask,c=this.isValidHeadConnectionMask;return t.add(o),t.add(n),t.add(i),t.add(s),t.add(c),t.add(a),t.add(r),t.add(e),this.updatePath("start",e.path[0][1],e.path[0][2],!0),this.updatePath("end",e.path[1][3],e.path[1][4],!0),this.updatePath("control",e.path[1][1],e.path[1][2],!0),this}},{key:"connectLink",value:function(t,e,o){var n,i=this;this.isValidConnection(t,e,o)&&(n=this.canvas.getObjects().find(function(t){return t.id===e}),this.disconnectLink(t),this[t]={shape:n,anchor:o,handlers:{onAnchorPositionModifying:function(){i.updatePath(t,n.anchors[o].left,n.anchors[o].top,!1)},onAnchorPositionModified:function(){i.updatePath(t,n.anchors[o].left,n.anchors[o].top,!0)}}},n.anchors[o].opacity=0,n.anchors[o].on("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),n.anchors[o].on("pg:position:modified",this[t].handlers.onAnchorPositionModified),this.updatePath(t,n.anchors[o].left,n.anchors[o].top,!0,!1))}},{key:"disconnectLink",value:function(t){this[t]&&(this[t].shape.anchors[this[t].anchor].off("pg:position:modifying",this[t].handlers.onAnchorPositionModifying),this[t].shape.anchors[this[t].anchor].off("pg:position:modified",this[t].handlers.onAnchorPositionModified),delete this[t])}},{key:"resetCurvature",value:function(){var t=this.controlPoint,e=this.path;t.left=(e.path[0][1]+e.path[1][3])/2,t.top=(e.path[0][2]+e.path[1][4])/2,t.setCoords(),t.fire("moved")}},{key:"bringToFront",value:function(){var t=this.canvas,e=this.path,o=this.controlPoint,n=this.arrowHead,i=this.arrowTail;t.bringToFront(e),t.bringToFront(o),t.bringToFront(n),t.bringToFront(i)}},{key:"updatePath",value:function(t,e,o,n,i){var a,e={M:{x:"start"===t?e:this.path.path[0][1],y:"start"===t?o:this.path.path[0][2]},Q:{x1:"control"===t?e:this.path.path[1][1],y1:"control"===t?o:this.path.path[1][2],x2:"end"===t?e:this.path.path[1][3],y2:"end"===t?o:this.path.path[1][4]}};n?(t="M ".concat(e.M.x," ").concat(e.M.y," Q ").concat(e.Q.x1,", ").concat(e.Q.y1,", ").concat(e.Q.x2,", ").concat(e.Q.y2),o=new d.Path(t,this.defaultPathOptions),this.canvas.remove(this.path),this.canvas.add(o),o.on("mouseover",this.onLinkMouseOver.bind(this)),o.on("mouseout",this.onLinkMouseOut.bind(this)),o.on("mousedown",this.bringToFront.bind(this)),o.on("moving",this.onLinkMoving.bind(this)),o.on("moved",this.onLinkMoved.bind(this)),n=[this.arrowHead,this.arrowTail,this.controlPoint,this.controlLine1,this.controlLine2],t=o.calcTransformMatrix(),a=d.util.invertTransform(t),n.forEach(function(t){var e=d.util.multiplyTransformMatrices(a,t.calcTransformMatrix());t.relationship=e}),this.path=o):this.path.set("path",[["M",e.M.x,e.M.y],["Q",e.Q.x1,e.Q.y1,e.Q.x2,e.Q.y2]]),this.controlLine1.set({x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.path.path[0][1],y2:this.path.path[0][2]}),this.controlLine2.set({x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.path.path[1][3],y2:this.path.path[1][4]});e=180*Math.atan2(this.path.path[1][4]-this.path.path[1][2],this.path.path[1][3]-this.path.path[1][1])/Math.PI;this.arrowHead.angle=90+e,this.arrowHead.left=this.path.path[1][3],this.arrowHead.top=this.path.path[1][4],this.arrowHead.setCoords(),this.arrowTail.left=this.path.path[0][1],this.arrowTail.top=this.path.path[0][2],this.arrowTail.setCoords(),this.bringToFront(),i&&this.resetCurvature()}},{key:"isValidConnection",value:function(t,e,o){var n=this.canvas.getObjects().find(function(t){return t.id===e});if("start"===t){if(this.start&&this.start.shape&&this.start.shape.id===n.id&&this.start.cardinal===o)return!1;if(this.end&&this.end.shape&&this.end.shape.id===n.id)return!1}else if("end"===t){if(this.end&&this.end.shape&&this.end.shape.id===n.id&&this.end.cardinal===o)return!1;if(this.start&&this.start.shape&&this.start.shape.id===n.id)return!1}return!0}},{key:"toggleAllAnchorsOpacity",value:function(t){for(var e=this.canvas.getObjects().filter(function(t){return"anchor"===t.type}),o=0;o<e.length;o+=1)e[o].set("opacity",t);this.canvas.renderAll()}},{key:"onLinkMouseOver",value:function(){this.controlPoint.toggleOpacity(1),this.controlLine1.toggleOpacity(1),this.controlLine2.toggleOpacity(1)}},{key:"onLinkMouseOut",value:function(){this.controlPoint.toggleOpacity(0),this.controlLine1.toggleOpacity(0),this.controlLine2.toggleOpacity(0)}},{key:"onLinkMoving",value:function(){var o=this;[this.arrowHead,this.arrowTail,this.controlPoint,this.controlLine1,this.controlLine2].forEach(function(t){var e;t.relationship&&(e=t.relationship,e=d.util.multiplyTransformMatrices(o.path.calcTransformMatrix(),e),e=d.util.qrDecompose(e),t.set({flipX:!1,flipY:!1}),t.setPositionByOrigin({x:e.translateX,y:e.translateY},"center","center"),t.set(e),t.setCoords())}),this._checkExtremityCanBeConnected("start"),this._checkExtremityCanBeConnected("end")}},{key:"onLinkMoved",value:function(){var t={M:{x:this.arrowTail.left,y:this.arrowTail.top},Q:{x1:this.controlPoint.left,y1:this.controlPoint.top,x2:this.arrowHead.left,y2:this.arrowHead.top}},t="M ".concat(t.M.x," ").concat(t.M.y," Q ").concat(t.Q.x1,", ").concat(t.Q.y1,", ").concat(t.Q.x2,", ").concat(t.Q.y2),t=new d.Path(t,{});this.updatePath("start",t.path[0][1],t.path[0][2],!1),this.updatePath("end",t.path[1][3],t.path[1][4],!1),this.updatePath("control",t.path[1][1],t.path[1][2],!0),this.isValidTailConnectionMask.set("opacity",0),this.isValidHeadConnectionMask.set("opacity",0),this._connectDisconnectExtremity("start"),this._connectDisconnectExtremity("end")}},{key:"_checkExtremityCanBeConnected",value:function(t){var e,o,n=this.canvas;"start"===t?(e=this.arrowTail,o=this.isValidTailConnectionMask):"end"===t&&(e=this.arrowHead,o=this.isValidHeadConnectionMask),o.left=e.left,o.top=e.top,o.setCoords(),o.set("opacity",0);var i=n.getObjects().filter(function(t){return"anchor"===t.type});e.set("stroke","#000");for(var a=0;a<i.length;a+=1)e.intersectsWithObject(i[a])&&(o.set("opacity",.5),this.isValidConnection(t,i[a].shapeId,i[a].cardinal)?(o.set({stroke:"#57b857",fill:"#57b857"}),e.set("stroke","#5f5")):(o.set({stroke:"#ea4f37",fill:"#ea4f37"}),e.set("stroke","#ea4f37")))}},{key:"_connectDisconnectExtremity",value:function(t){var e,o=this.canvas;"start"===t?e=this.arrowTail:"end"===t&&(e=this.arrowHead);for(var n=o.getObjects().filter(function(t){return"anchor"===t.type}),i=0;i<n.length;i+=1)e.intersectsWithObject(n[i])?(this.connectLink(t,n[i].shapeId,n[i].cardinal),e.set("stroke","#000")):this[t]&&n[i]===this[t].shape.anchors[this[t].anchor]&&this.disconnectLink(t)}}])&&n(t.prototype,e),o&&n(t,o),l}();o.default=i},{}],5:[function(t,e,o){"use strict";function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var f=window.fabric,i=function(){function d(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var o=t.id,i=t.canvas,a=t.shape,n=t.left,r=t.top,s=t.angle;this.options=t,this.id=o,this.canvas=i,a.set("type","linkableShape"),a.set({left:n,top:r,id:o,angle:s}),this.shape=a;var c=new f.Rect({left:0,top:0,originX:"center",originY:"center",strokeWidth:1,stroke:"#666",fill:"#fff",width:70,height:20,vented:!1,selectable:!1,opacity:0}),h=new f.Text("0, 0",{left:0,top:0,originX:"center",originY:"center",fontFamily:"Helvetica",fontSize:12,borderStrokeWidth:4,evented:!1,selectable:!1,opacity:0}),l=this.modBox=new f.Group([c,h],{left:0,top:0,originX:"center",originY:"center",evented:!1,selectable:!1});a.on({moving:function(){var t=a.aCoords.tl,e=t.x,o=t.y,n=[a.aCoords.tl.x,a.aCoords.tr.x,a.aCoords.bl.x,a.aCoords.br.x],t=[a.aCoords.tl.y,a.aCoords.tr.y,a.aCoords.bl.y,a.aCoords.br.y];l.left=(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,l.top=Math.round(Math.max.apply(Math,t)+30),l.setCoords(),c.set("opacity",.7),h.set("opacity",1),h.set("text","".concat(Math.round(e),", ").concat(Math.round(o))),i.bringToFront(l)},moved:function(){c.set("opacity",0),h.set("opacity",0)},rotating:function(){var t=[a.aCoords.tl.x,a.aCoords.tr.x,a.aCoords.bl.x,a.aCoords.br.x],e=[a.aCoords.tl.y,a.aCoords.tr.y,a.aCoords.bl.y,a.aCoords.br.y];l.left=(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,l.top=Math.round(Math.max.apply(Math,e)+30),l.setCoords(),c.set("opacity",.7),h.set("opacity",1),h.set("text","".concat(Math.round(180<a.angle?a.angle-360:a.angle),"°")),i.bringToFront(l)},rotated:function(){c.set("opacity",0),h.set("opacity",0)}}),this.anchors=this.shape.anchors={east:this._makeAnchorPoint("east"),west:this._makeAnchorPoint("west")},a.on({selected:function(){e.toggleAnchorsOpacity(0)},mouseover:function(){e.canvas.getActiveObject()!==e.shape&&e.toggleAnchorsOpacity(1)},mouseout:function(){e.toggleAnchorsOpacity(0)},modifying:function(){e.refreshAnchorsPosition(!1)},modified:function(){e.refreshAnchorsPosition(!0)},moving:function(){e.refreshAnchorsPosition(!1)},moved:function(){e.refreshAnchorsPosition(!0)},rotating:function(){e.refreshAnchorsPosition(!1)},rotated:function(){e.refreshAnchorsPosition(!0)},scaling:function(){e.refreshAnchorsPosition(!1)},scaled:function(){e.refreshAnchorsPosition(!0)}})}var t,e,o;return t=d,(e=[{key:"inject",value:function(){var e=this.canvas,t=this.shape,o=this.anchors,n=this.modBox;return e.add(t),e.add(n),Object.keys(o).forEach(function(t){e.add(o[t]),e.bringForward(o[t],!0)}),this.refreshAnchorsPosition(!0),this}},{key:"remove",value:function(){var e=this.canvas,t=this.shape,o=this.anchors,n=this.modBox;e.remove(t),e.remove(n),Object.keys(o).forEach(function(t){e.remove(o[t])})}},{key:"move",value:function(t){t.x&&this.shape.set("left",t.x),t.y&&this.shape.set("top",t.y),t.originX&&this.shape.set("originX",t.originX),t.originY&&this.shape.set("originY",t.originY),this.shape.setCoords(),this.refreshAnchorsPosition(),this.shape.fire(t.moving?"moving":"moved")}},{key:"rotate",value:function(t){this.shape.rotate(t),this.shape.setCoords(),this.refreshAnchorsPosition()}},{key:"refreshAnchorsPosition",value:function(e){var o=this;Object.keys(this.anchors).forEach(function(t){o._setAnchorPositionRelativeToRectangle(t,e)})}},{key:"toggleAnchorsOpacity",value:function(e){var o=this;Object.keys(this.anchors).forEach(function(t){o.anchors[t].toggleOpacity(e)})}},{key:"bringToFront",value:function(){var e=this.canvas,t=this.shape,o=this.modBox,n=this.anchors;t.bringToFront(),o.bringToFront(),Object.keys(n).forEach(function(t){e.bringToFront(n[t])})}},{key:"_setAnchorPositionRelativeToRectangle",value:function(t,e){var o,n,i=this.shape,a=this.anchors[t];switch(t){case"east":o=(i.aCoords.tr.x+i.aCoords.br.x)/2,n=(i.aCoords.tr.y+i.aCoords.br.y)/2;break;case"west":o=(i.aCoords.tl.x+i.aCoords.bl.x)/2,n=(i.aCoords.tl.y+i.aCoords.bl.y)/2;break;case"north":o=(i.aCoords.tl.x+i.aCoords.tr.x)/2,n=(i.aCoords.tl.y+i.aCoords.tr.y)/2;break;case"south":o=(i.aCoords.bl.x+i.aCoords.br.x)/2,n=(i.aCoords.bl.y+i.aCoords.br.y)/2;break;case"northeast":o=i.aCoords.tr.x,n=i.aCoords.tr.y;break;case"northwest":o=i.aCoords.tl.x,n=i.aCoords.tl.y;break;case"southeast":o=i.aCoords.br.x,n=i.aCoords.br.y;break;default:o=i.aCoords.bl.x,n=i.aCoords.bl.y}a.left=o,a.top=n,a.setCoords(),a.fire(e?"pg:position:modified":"pg:position:modifying")}},{key:"_makeAnchorPoint",value:function(t){var e,o,n=this,i=this.shape,a=this.id;switch(t){case"east":e=(i.aCoords.tr.x+i.aCoords.br.x)/2,o=(i.aCoords.tr.y+i.aCoords.br.y)/2;break;case"west":e=(i.aCoords.tl.x+i.aCoords.bl.x)/2,o=(i.aCoords.tl.y+i.aCoords.bl.y)/2;break;case"north":e=(i.aCoords.tl.x+i.aCoords.tr.x)/2,o=(i.aCoords.tl.y+i.aCoords.tr.y)/2;break;case"south":e=(i.aCoords.bl.x+i.aCoords.br.x)/2,o=(i.aCoords.bl.y+i.aCoords.br.y)/2;break;case"northeast":e=i.aCoords.tr.x,o=i.aCoords.tr.y;break;case"northwest":e=i.aCoords.tl.x,o=i.aCoords.tl.y;break;case"southeast":e=i.aCoords.br.x,o=i.aCoords.br.y;break;default:e=i.aCoords.bl.x,o=i.aCoords.bl.y}var r=new f.Circle({objectCaching:!1,left:e,top:o,strokeWidth:2,radius:6,fill:"#78befa",stroke:"#78befa",originX:"center",originY:"center",hasBorders:!1,hasControls:!1,selectable:!1,opacity:0,id:"".concat(a,"_").concat(t)});return r.type="anchor",r.shapeId=a,r.cardinal=t,r.on("mouseover",function(){r.toggleOpacity(1)}),r.on("mouseout",function(){r.toggleOpacity(0)}),r.on("mousedown",function(t){switch(t.button){case 3:n._onAnchorRightClick.call(n,t);break;case 2:n._onAnchorMiddleClick.call(n,t);break;default:n._onAnchorLeftClick.call(n,t)}}),r}},{key:"_onAnchorLeftClick",value:function(){}},{key:"_onAnchorMiddleClick",value:function(){}},{key:"_onAnchorRightClick",value:function(){}}])&&n(t.prototype,e),o&&n(t,o),d}();o.default=i},{}],6:[function(t,e,o){"use strict";function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=window.fabric,n=function(){function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.handlers={grid:{}};var e=this.canvas=t.canvas||new a.Canvas(t.canvasOpts.el,t.canvasOpts.options);e.set("preserveObjectStacking",!0),e.set("fireRightClick",!0),e.set("fireMiddleClick",!0),e.set("stopContextMenu",!0),"number"==typeof t.grid&&this.setGrid({grid:t.grid}),a.Object.prototype.toggleOpacity=function(t){this.set("opacity",t),this.canvas.renderAll()},e.calcOffset();t=function(){var t=e.getActiveObject();"activeSelection"!==t.type||1<(t=t.getObjects()).length&&(t=t.filter(function(t){return"linkableShape"===t.type}),e._discardActiveObject(),t=new a.ActiveSelection(t,{canvas:e}),e._setActiveObject(t))};e.on({"selection:created":t,"selection:updated":t})}var t,e,n;return t=o,(e=[{key:"setGrid",value:function(t){var f=this;if("number"!=typeof t.grid||t.grid<0)throw new Error('Invalid argument "grid" in ProcessGrap#setGrid. (required: Number > 0)');this.grid=t.grid;var o=this.canvas,e='<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">         <defs>             <pattern id="smallGrid" width="'.concat(this.grid,'" height="').concat(this.grid,'" patternUnits="userSpaceOnUse">                 <path d="M ').concat(this.grid," 0 L 0 0 0 ").concat(this.grid,'" fill="none" stroke="gray" stroke-width="0.5" />             </pattern>             <pattern id="grid" width="').concat(5*this.grid,'" height="').concat(5*this.grid,'" patternUnits="userSpaceOnUse">                 <rect width="').concat(5*this.grid,'" height="').concat(5*this.grid,'" fill="url(#smallGrid)" />                 <path d="M ').concat(5*this.grid," 0 L 0 0 0 ").concat(5*this.grid,'" fill="none" stroke="gray" stroke-width="1" />             </pattern>         </defs>         <rect width="100%" height="100%" fill="url(#grid)" />     </svg>'),t=window.URL||window.webkitURL||window,e=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),e=t.createObjectURL(e);a.util.loadImage(e,function(t){var e=new a.Rect({width:o.width,height:o.height,evented:!1,selectable:!1});e.fill=new a.Pattern({source:t},function(){e.dirty=!0,o.requestRenderAll()}),(e.canvas=o).set("backgroundImage",e),o.off(f.handlers.grid),f.handlers.grid={"object:moving":function(t){var e=f.grid;"linkableShape"===t.target.type&&t.target.set({left:Math.round(t.target.left/e)*e,top:Math.round(t.target.top/e)*e})},"object:scaling":function(t){var e=f.grid,o=t.target;if("linkableShape"===o.type){var n=o.width*o.scaleX,i=o.height*o.scaleY,a={top:Math.round(o.top/e)*e,left:Math.round(o.left/e)*e,bottom:Math.round((o.top+i)/e)*e,right:Math.round((o.left+n)/e)*e},r=e,s=Math.abs(a.top-o.top),c=Math.abs(a.left-o.left),h=Math.abs(a.bottom-o.top-i),l=Math.abs(a.right-o.left-n),d={scaleX:o.scaleX,scaleY:o.scaleY,top:o.top,left:o.left};switch(o.__corner){case"tl":c<s&&c<r?(d.scaleX=(n-(a.left-o.left))/o.width,d.scaleY=d.scaleX/o.scaleX*o.scaleY,d.top=o.top+(i-o.height*d.scaleY),d.left=a.left):s<r&&(d.scaleY=(i-(a.top-o.top))/o.height,d.scaleX=d.scaleY/o.scaleY*o.scaleX,d.left+=n-o.width*d.scaleX,d.top=a.top);break;case"mt":s<r&&(d.scaleY=(i-(a.top-o.top))/o.height,d.top=a.top);break;case"tr":l<s&&l<r?(d.scaleX=(a.right-o.left)/o.width,d.scaleY=d.scaleX/o.scaleX*o.scaleY,d.top=o.top+(i-o.height*d.scaleY)):s<r&&(d.scaleY=(i-(a.top-o.top))/o.height,d.scaleX=d.scaleY/o.scaleY*o.scaleX,d.top=a.top);break;case"ml":c<r&&(d.scaleX=(n-(a.left-o.left))/o.width,d.left=a.left);break;case"mr":l<r&&(d.scaleX=(a.right-o.left)/o.width);break;case"bl":c<h&&c<r?(d.scaleX=(n-(a.left-o.left))/o.width,d.scaleY=d.scaleX/o.scaleX*o.scaleY,d.left=a.left):h<r&&(d.scaleY=(a.bottom-o.top)/o.height,d.scaleX=d.scaleY/o.scaleY*o.scaleX,d.left+=n-o.width*d.scaleX);break;case"mb":h<r&&(d.scaleY=(a.bottom-o.top)/o.height);break;default:l<h&&l<r?(d.scaleX=(a.right-o.left)/o.width,d.scaleY=d.scaleX/o.scaleX*o.scaleY):h<r&&(d.scaleY=(a.bottom-o.top)/o.height,d.scaleX=d.scaleY/o.scaleY*o.scaleX)}o.set(d),o.setCoords()}}},0<f.grid&&o.on(f.handlers.grid)})}}])&&i(t.prototype,e),n&&i(t,n),o}();o.default=n},{}]},{},[1]);
//# sourceMappingURL=fabricjs-process-graph.min.js.map